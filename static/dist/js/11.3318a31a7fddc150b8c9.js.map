{"version":3,"sources":["webpack:///./js/invenio_previewer/csv_previewer/csv_d3js.js","webpack:///./js/invenio_previewer/csv_previewer/loader.js","webpack:///./js/invenio_previewer/csv_previewer/init.js"],"names":["flight","component","CSV_D3JS","this","tabulate","data","target","columns","table","d3","select","append","classed","thead","tbody","selectAll","enter","text","column","next","chunk_size","chunks","Math","ceil","length","loadNext","undefined","id","trigger","document","ev","slice","row","map","value","d","after","node","delimiter","$node","encoding","resource","dsv","col","Object","keys","on","Loader","handleShowLoader","show","handleHideLoader","hide","preventDefault","$","each","attachTo"],"mappings":"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","file":"js/11.3318a31a7fddc150b8c9.js","sourcesContent":["/*\n * This file is part of Invenio.\n * Copyright (C) 2015-2020 CERN.\n *\n * Invenio is free software; you can redistribute it and/or modify it\n * under the terms of the MIT License; see LICENSE file for more details.\n */\n\nimport d3 from \"d3\";\nimport flight from \"flightjs\";\n\nfunction CSV_D3JS() {\n  var CSV_D3JS;\n\n  this.tabulate = function(data, target, columns) {\n    var table = d3\n      .select(target)\n      .append(\"table\")\n      .classed({\n        table: true,\n        \"table-hover\": true,\n        \"table-bordered\": true,\n      });\n    CSV_D3JS.thead = table.append(\"thead\");\n    CSV_D3JS.tbody = table.append(\"tbody\");\n    CSV_D3JS.columns = columns;\n    CSV_D3JS.data = data;\n\n    // append the header row\n    CSV_D3JS.thead\n      .append(\"tr\")\n      .selectAll(\"th\")\n      .data(CSV_D3JS.columns)\n      .enter()\n      .append(\"th\")\n      .text(function(column) {\n        return column;\n      });\n\n    CSV_D3JS.next = 1;\n    CSV_D3JS.chunk_size = 500;\n    CSV_D3JS.chunks = Math.ceil(CSV_D3JS.data.length / CSV_D3JS.chunk_size);\n\n    CSV_D3JS.loadNext(undefined, {\n      id: CSV_D3JS.id,\n    });\n    if (CSV_D3JS.chunks > 1) {\n      CSV_D3JS.trigger(document, \"showLoader\", {\n        id: CSV_D3JS.id,\n      });\n    }\n\n    return true;\n  };\n\n  this.loadNext = function(ev, data) {\n    if (data.id === CSV_D3JS.id && CSV_D3JS.next <= CSV_D3JS.chunks) {\n      // create a row for each object in the data chunk\n      CSV_D3JS.tbody\n        .selectAll(\"tr\")\n        .data(CSV_D3JS.data.slice(0, CSV_D3JS.next * CSV_D3JS.chunk_size))\n        .enter()\n        .append(\"tr\")\n        .selectAll(\"td\")\n        .data(function(row) {\n          return CSV_D3JS.columns.map(function(column) {\n            return { column: column, value: row[column] };\n          });\n        })\n        .enter()\n        .append(\"td\")\n        .text(function(d) {\n          return d.value;\n        });\n\n      if (CSV_D3JS.next === CSV_D3JS.chunks) {\n        CSV_D3JS.trigger(document, \"hideLoader\", {\n          id: CSV_D3JS.id,\n        });\n      }\n      CSV_D3JS.next += 1;\n    }\n  };\n\n  this.after(\"initialize\", function() {\n    CSV_D3JS = this;\n    CSV_D3JS.id = CSV_D3JS.node.id;\n\n    var delimiter = CSV_D3JS.$node.data(\"csv-delimiter\"),\n      encoding = CSV_D3JS.$node.data(\"csv-encoding\"),\n      resource = CSV_D3JS.$node.data(\"csv-source\"),\n      dsv = d3.dsv(delimiter, \"text/csv; charset=\" + encoding);\n\n    dsv(resource, function(data) {\n      var col = Object.keys(data[0]);\n      CSV_D3JS.tabulate(data, CSV_D3JS.node, col);\n    });\n\n    this.on(document, \"loadNext\", this.loadNext);\n  });\n}\n\nexport default flight.component(CSV_D3JS);\n","/*\n * This file is part of Invenio.\n * Copyright (C) 2015-2020 CERN.\n *\n * Invenio is free software; you can redistribute it and/or modify it\n * under the terms of the MIT License; see LICENSE file for more details.\n */\n\nimport flight from \"flightjs\";\n\nfunction Loader() {\n  var Loader;\n\n  this.handleShowLoader = function (ev, data) {\n    if (data.id === Loader.id) {\n      this.$node.show();\n    }\n  };\n\n  this.handleHideLoader = function (ev, data) {\n    if (data.id === Loader.id) {\n      this.$node.hide();\n    }\n  };\n\n  this.after(\"initialize\", function () {\n    Loader = this;\n    Loader.id = Loader.$node.data(\"csv-target\");\n\n    Loader.on(document, \"showLoader\", Loader.handleShowLoader);\n    Loader.on(document, \"hideLoader\", Loader.handleHideLoader);\n    Loader.on(\"click\", function (ev) {\n      ev.preventDefault();\n      Loader.trigger(document, \"loadNext\", {\n        id: Loader.id,\n      });\n    });\n\n    Loader.$node.hide();\n  });\n}\n\nexport default flight.component(Loader);\n","/*\n * This file is part of Invenio.\n * Copyright (C) 2015-2020 CERN.\n *\n * Invenio is free software; you can redistribute it and/or modify it\n * under the terms of the MIT License; see LICENSE file for more details.\n */\n\nimport $ from \"jquery\";\nimport CSV_D3JS from \"./csv_d3js\";\nimport Loader from \"./loader.js\";\n\n$(function () {\n  $(\"[data-csv-source]\").each(function () {\n    CSV_D3JS.attachTo($(this));\n  });\n  $(\"[data-csv-target]\").each(function () {\n    Loader.attachTo($(this));\n  });\n});\n"],"sourceRoot":""}