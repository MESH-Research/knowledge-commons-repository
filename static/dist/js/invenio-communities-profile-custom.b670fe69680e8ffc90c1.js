"use strict";(self.webpackChunkinvenio_assets=self.webpackChunkinvenio_assets||[]).push([[7291],{13596:(e,t,n)=>{var r=n(96540),a=n(40961),i=n(10467),o=n(23029),l=n(92901),c=n(56822),u=n(53954),s=n(85501),m=n(64467),d=n(54756),f=n.n(d),p=n(38102),h=n(17684),b=n(88055),g=n.n(b),v=n(74354),y=n.n(v),A=n(58156),E=n.n(A),w=n(56449),C=n.n(w),k=n(53812),O=n.n(k),x=n(62193),S=n.n(x),M=n(5187),R=n.n(M),F=n(98023),P=n.n(F),z=n(23805),D=n.n(z),j=n(55378),N=n.n(j),I=n(73916),T=n.n(I),L=n(44383),q=n.n(L),U=n(71086),_=n.n(U),B=n(73357),J=n.n(B),V=n(91751),G=n(81057),W=n(80501),Y=n(87395),H=n(1489),Q=n(36713),K=n(3487),Z=n(76217),X=n(15941);function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){(0,m.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var te=function(){return(0,l.A)((function e(){(0,o.A)(this,e),(0,m.A)(this,"baseUrl","/api/communities")}),[{key:"create",value:function(){var e=(0,i.A)(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=n||{},e.abrupt("return",G.http.post(this.baseUrl,t,ee({},n)));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=(0,i.A)(f().mark((function e(t,n,r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=r||{},e.abrupt("return",G.http.put("".concat(this.baseUrl,"/").concat(t),n,ee({},r)));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=(0,i.A)(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=n||{},e.abrupt("return",G.http.delete("".concat(this.baseUrl,"/").concat(t),ee({},n)));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"renameSlug",value:function(){var e=(0,i.A)(f().mark((function e(t,n,r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=r||{},e.abrupt("return",G.http.post("".concat(this.baseUrl,"/").concat(t,"/rename"),{slug:n},ee({},r)));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"updateLogo",value:function(){var e=(0,i.A)(f().mark((function e(t,n,r){var a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=r||{},a={"Content-Type":"application/octet-stream"},e.abrupt("return",G.http.put("".concat(this.baseUrl,"/").concat(t,"/logo"),n,ee({headers:a},r)));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"deleteLogo",value:function(){var e=(0,i.A)(f().mark((function e(t,n){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=n||{},r={"Content-Type":"application/octet-stream"},e.abrupt("return",G.http.delete("".concat(this.baseUrl,"/").concat(t,"/logo"),ee({headers:r},n)));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}])}();var ne=function(e){var t,n,r;return{message:null===e||void 0===e||null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message,errors:null===e||void 0===e||null===(n=e.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.errors,status:null===e||void 0===e||null===(r=e.response)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.status}},re=n(80296),ae=n(63560),ie=n.n(ae);function oe(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function le(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var ce=new WeakSet,ue=function(){return(0,l.A)((function e(t){var n=t.fieldpath,r=t.deserializedDefault,a=void 0===r?null:r,i=t.serializedDefault,l=void 0===i?null:i,c=t.allowEmpty,u=void 0!==c&&c,s=t.vocabularyFields,m=void 0===s?[]:s;(0,o.A)(this,e),oe(this,ce),this.fieldpath=n,this.deserializedDefault=a,this.serializedDefault=l,this.allowEmpty=u,this.vocabularyFields=m}),[{key:"deserialize",value:function(e){var t=g()(e),n=E()(e,this.fieldpath,this.deserializedDefault);return le(ce,this,se).call(this,t,n,(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&null!==e&&void 0!==e&&e.id?e.id:(t&&(e.__key=t),e)})),t}},{key:"serialize",value:function(e){var t=g()(e),n=E()(e,this.fieldpath,this.serializedDefault);return le(ce,this,se).call(this,t,n,(function(e){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&"string"===typeof e?{id:e}:(delete e.__key,e)})),t}}])}();function se(e,t,n){var r=this;if(null!==t)for(var a=function(){var t=(0,re.A)(o[i],2),a=t[0],l=t[1],c=r.vocabularyFields.includes(a),u=C()(l)?l.map((function(e,t){return n(e,t,c)})):n(l,null,c);e=ie()(e,"custom_fields.".concat(a),u)},i=0,o=Object.entries(t);i<o.length;i++)a()}var me=n(5556),de=n.n(me),fe=n(2685),pe=n(27041),he=n(58168),be=n(48423);function ge(e,t,n){return t=(0,u.A)(t),(0,c.A)(e,ve()?Reflect.construct(t,n||[],(0,u.A)(e).constructor):t.apply(e,n))}function ve(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ve=function(){return!!e})()}var ye=function(e){function t(e){var n;return(0,o.A)(this,t),n=ge(this,t,[e]),(0,m.A)(n,"handleOpen",(function(){return n.setState({modalOpen:!0})})),(0,m.A)(n,"handleClose",(function(){n.setState({modalOpen:!1}),n.modalTriggerRef.current.focus()})),(0,m.A)(n,"handleChange",function(){var e=(0,i.A)(f().mark((function e(t){var r,a,i,o,l,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.stopPropagation(),r=n.props.community,a=n.formInputRef.current.value,i=new te,n.cancellableRename=(0,G.withCancel)(i.renameSlug(r.id,a)),n.setState({loading:!0}),e.prev=6,e.next=9,n.cancellableRename.promise;case 9:window.location.href="/communities/".concat(a,"/settings"),e.next=19;break;case 12:if(e.prev=12,e.t0=e.catch(6),"UNMOUNTED"!==e.t0){e.next=16;break}return e.abrupt("return");case 16:n.setState({loading:!1}),o=ne(e.t0),(l=o.errors)&&(c=l.filter((function(e){return"slug"===e.field})).map((function(e){return e.messages[0]})),n.setState({error:c}),n.formInputRef.current.focus());case 19:case"end":return e.stop()}}),e,null,[[6,12]])})));return function(t){return e.apply(this,arguments)}}()),n.state={modalOpen:!1,loading:!1,error:""},n.formInputRef=r.createRef(),n.modalTriggerRef=r.createRef(),n}return(0,s.A)(t,e),(0,l.A)(t,[{key:"componentDidUpdate",value:function(){this.formInputRef.current&&this.formInputRef.current.focus()}},{key:"componentWillUnmount",value:function(){this.cancellableRename&&this.cancellableRename.cancel()}},{key:"render",value:function(){var e=this.state,t=e.modalOpen,n=e.loading,a=e.error;return r.createElement(r.Fragment,null,r.createElement(K.A,{ref:this.modalTriggerRef,compact:!0,negative:!0,onClick:this.handleOpen,fluid:!0,icon:!0,labelPosition:"left",type:"button"},r.createElement(Z.A,{name:"pencil"}),p.M.t("Change identifier")),r.createElement(be.A,{open:t,onClose:this.handleClose,size:"tiny"},r.createElement(be.A.Content,null,r.createElement(W.A,{onSubmit:this.handleChange},r.createElement(W.A.Input,(0,he.A)({label:p.M.t("New unique identifier of the community"),placeholder:p.M.t("New unique identifier of the community"),fluid:!0,input:{ref:this.formInputRef}},a?{error:{content:a,pointing:"above"}}:{})))),r.createElement(be.A.Actions,null,r.createElement(K.A,{onClick:this.handleClose,loading:n,disabled:n,floated:"left"},p.M.t("Cancel")),r.createElement(K.A,{negative:!0,onClick:this.handleChange,loading:n,disabled:n},p.M.t("Change")))))}}])}(r.Component);ye.propTypes={community:de().object.isRequired,onError:de().func.isRequired};var Ae=n(6549),Ee=n(50363),we=n(92257),Ce=n(52822);function ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(n),!0).forEach((function(t){(0,m.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ke(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xe(e,t,n){return t=(0,u.A)(t),(0,c.A)(e,Se()?Reflect.construct(t,n||[],(0,u.A)(e).constructor):t.apply(e,n))}function Se(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Se=function(){return!!e})()}var Me=function(e){function t(e){var n;return(0,o.A)(this,t),n=xe(this,t,[e]),(0,m.A)(n,"updateCommunityMetrics",(0,i.A)(f().mark((function e(){var t,r,a,i,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({loading:!0}),t=n.props.community,n.cancellableMembersCountFetch=(0,G.withCancel)(G.http.get(t.links.members)),n.cancellableRecordsCountFetch=(0,G.withCancel)(G.http.get(t.links.records)),e.prev=4,e.next=7,n.cancellableMembersCountFetch.promise;case 7:return r=e.sent,e.next=10,n.cancellableRecordsCountFetch.promise;case 10:a=e.sent,n.setState({loading:!1,membersCount:r.data.hits.total,recordsCount:0===a.data.length?0:a.data.hits.total}),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(4),console.error(e.t0),i=ne(e.t0),(o=i.message)&&n.setState({error:o,loading:!1});case 19:case"end":return e.stop()}}),e,null,[[4,14]])})))),(0,m.A)(n,"handleInputChange",(function(e){n.setState({inputSlug:e.target.value})})),(0,m.A)(n,"handleCheckboxChange",(function(e,t){var r=t.id,a=t.checked;"members-confirm"===r&&n.setState({checkboxMembers:a}),"records-confirm"===r&&n.setState({checkboxRecords:a}),"slug-confirm"===r&&n.setState({checkboxSlug:a})})),(0,m.A)(n,"handleButtonDisabled",(function(e){var t=n.state,r=t.checkboxRecords,a=t.checkboxMembers,i=t.checkboxSlug,o=t.inputSlug;return!(a&&r&&i&&o===e)})),(0,m.A)(n,"openConfirmModal",(function(){return n.setState({modalOpen:!0})})),(0,m.A)(n,"closeConfirmModal",(function(){var e,t=n.state.loading;n.setState(Oe(Oe({},n.INITIAL_STATE),{},{loading:t})),null===(e=n.openModalBtnRef)||void 0===e||null===(e=e.current)||void 0===e||e.focus()})),(0,m.A)(n,"handleDelete",(0,i.A)(f().mark((function e(){var t,r,a,i,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({loading:!0}),t=n.props,r=t.onDelete,a=t.redirectURL,n.cancellableDelete=(0,G.withCancel)(r()),e.prev=3,e.next=6,n.cancellableDelete.promise;case 6:a&&(window.location.href=a),n.closeConfirmModal(),e.next=17;break;case 10:if(e.prev=10,e.t0=e.catch(3),"UNMOUNTED"!==e.t0){e.next=14;break}return e.abrupt("return");case 14:console.error(e.t0),i=ne(e.t0),(o=i.message)&&n.setState({error:o,loading:!1});case 17:case"end":return e.stop()}}),e,null,[[3,10]])})))),n.INITIAL_STATE={modalOpen:!1,loading:!0,checkboxMembers:!1,checkboxRecords:!1,checkboxSlug:!1,inputSlug:"",error:void 0},n.checkboxRef=r.createRef(),n.openModalBtnRef=r.createRef(),n.state=n.INITIAL_STATE,n}return(0,s.A)(t,e),(0,l.A)(t,[{key:"componentDidMount",value:function(){this.updateCommunityMetrics()}},{key:"componentDidUpdate",value:function(e,t){var n=this.state,r=n.loading,a=n.modalOpen;!r&&a&&a!==t.modalOpen&&this.checkboxRef.current.inputRef.current.focus()}},{key:"componentWillUnmount",value:function(){this.cancellableDelete&&this.cancellableDelete.cancel(),this.cancellableMembersCountFetch&&this.cancellableMembersCountFetch.cancel(),this.cancellableRecordsCountFetch&&this.cancellableRecordsCountFetch.cancel()}},{key:"render",value:function(){var e=this,t=this.state,n=t.modalOpen,a=t.loading,i=t.error,o=t.checkboxMembers,l=t.checkboxRecords,c=t.checkboxSlug,u=t.inputSlug,s=t.membersCount,m=t.recordsCount,d=this.props,f=d.label,h=d.community.slug;return r.createElement(r.Fragment,null,r.createElement(K.A,{ref:this.openModalBtnRef,compact:!0,negative:!0,onClick:this.openConfirmModal,fluid:!0,icon:!0,labelPosition:"left",type:"button","aria-haspopup":"dialog","aria-controls":"warning-modal","aria-expanded":n,id:"delete-community-button"},r.createElement(Z.A,{name:"trash"}),f),r.createElement(be.A,{id:"warning-modal",role:"dialog","aria-labelledby":"delete-community-button",open:n,onClose:this.closeConfirmModal,size:"tiny"},r.createElement(be.A.Header,{as:"h2"},p.M.t("Permanently delete community")),a&&r.createElement(Ae.A,{active:a}),r.createElement(be.A.Content,null,r.createElement("p",null,r.createElement(Ce.x,null,"Are you ",r.createElement("strong",null,"absolutely sure")," you want to delete the community?")),r.createElement(Y.A,{negative:!0},r.createElement(Y.A.Header,{className:"rel-mb-1"},r.createElement(Z.A,{name:"warning sign",className:"rel-mr-1"}),p.M.t("This action CANNOT be undone!")),r.createElement(r.Fragment,null,r.createElement(Ee.A,{id:"members-confirm",ref:this.checkboxRef,label:r.createElement("label",{htmlFor:"members-confirm"},r.createElement(Ce.x,null,r.createElement("strong",null,"".concat(s)," members")," will be removed from the community.")),checked:o,onChange:this.handleCheckboxChange,className:"mb-5"}),r.createElement(Ee.A,{id:"records-confirm",label:r.createElement("label",{htmlFor:"records-confirm"},r.createElement(Ce.x,null,r.createElement("strong",null,"".concat(m)," records")," will be removed from the community.")),checked:l,onChange:this.handleCheckboxChange,className:"mb-5"}),r.createElement(Ee.A,{id:"slug-confirm",label:r.createElement("label",{htmlFor:"slug-confirm"},r.createElement(Ce.x,null,"You ",r.createElement("strong",null,"CANNOT"),' reuse the community identifier "',{communitySlug:h},'".')),checked:c,onChange:this.handleCheckboxChange,className:"mb-5"}))),r.createElement("label",{htmlFor:"confirm-delete"},r.createElement(Ce.x,null,"Please type ",r.createElement("strong",null,{communitySlug:h})," to confirm.")),r.createElement(we.A,{id:"confirm-delete",fluid:!0,value:u,onChange:this.handleInputChange})),r.createElement(be.A.Actions,null,i&&r.createElement(G.ErrorMessage,{header:p.M.t("Unable to delete"),content:p.M.t(i),icon:"exclamation",className:"text-align-left",negative:!0}),r.createElement(K.A,{onClick:this.closeConfirmModal,floated:"left"},p.M.t("Cancel")),r.createElement(K.A,{negative:!0,onClick:function(){return e.handleDelete()},disabled:this.handleButtonDisabled(h)},p.M.t("Permanently delete")))))}}])}(r.Component);Me.propTypes={onDelete:de().func.isRequired,redirectURL:de().string.isRequired,label:de().string.isRequired,community:de().object.isRequired};var Re=function(e){var t=e.community,n=e.onError,a=e.permissions;return a.can_delete||a.can_rename?r.createElement(fe.A,{className:"negative rel-mt-2"},r.createElement(pe.A,{as:"h2",className:"negative"},p.M.t("Danger zone")),r.createElement(H.A,null,a.can_rename&&r.createElement(r.Fragment,null,r.createElement(H.A.Column,{mobile:16,tablet:10,computer:12},r.createElement(pe.A,{as:"h3",size:"small"},p.M.t("Change identifier")),r.createElement("p",null,p.M.t("Changing your community's unique identifier can have unintended side effects."))),r.createElement(H.A.Column,{mobile:16,tablet:6,computer:4,floated:"right"},r.createElement(ye,{community:t,onError:n}))),a.can_delete&&r.createElement(r.Fragment,null,r.createElement(H.A.Column,{mobile:16,tablet:10,computer:12,floated:"left"},r.createElement(pe.A,{as:"h3",size:"small"},p.M.t("Delete community")),r.createElement("p",null,p.M.t("Once deleted, it will be gone forever. Please be certain."))),r.createElement(H.A.Column,{mobile:16,tablet:6,computer:4,floated:"right"},r.createElement(Me,{community:t,label:p.M.t("Delete community"),redirectURL:"/communities",onDelete:(0,i.A)(f().mark((function e(){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new te,e.next=3,n.delete(t.id);case 3:case"end":return e.stop()}}),e)})))}))))):null};Re.propTypes={community:de().object.isRequired,onError:de().func.isRequired,permissions:de().object.isRequired};const Fe=Re;var Pe=n(75497),ze=function(e){var t=(0,r.useState)(!1),n=(0,re.A)(t,2),a=n[0],o=n[1],l=(0,r.useState)(!1),c=(0,re.A)(l,2),u=c[0],s=c[1],m=r.createRef(),d=r.createRef(),h=function(){var e;o(!1),s(!1),null===d||void 0===d||null===(e=d.current)||void 0===e||e.focus()},b=function(){var t=(0,i.A)(f().mark((function t(){var n,r,a;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s(!0),n=e.onDelete,r=e.redirectURL,a=e.onError,t.prev=2,t.next=5,n();case 5:r&&(window.location.href=r),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(2),a(t.t0);case 11:h();case 12:case"end":return t.stop()}}),t,null,[[2,8]])})));return function(){return t.apply(this,arguments)}}();(0,r.useEffect)((function(){var e;a&&(null===m||void 0===m||null===(e=m.current)||void 0===e||e.focus())}),[a,m]);var g=e.label,v=e.confirmationMessage,y=e.id;return r.createElement(r.Fragment,null,r.createElement(K.A,{ref:d,compact:!0,negative:!0,onClick:function(){return o(!0)},fluid:!0,icon:!0,labelPosition:"left",type:"button","aria-haspopup":"dialog","aria-controls":"warning-modal","aria-expanded":a,id:y},r.createElement(Z.A,{name:"trash"}),g),r.createElement(be.A,{id:"warning-modal",role:"dialog","aria-labelledby":y,open:a,onClose:h,size:"tiny"},r.createElement(be.A.Content,null,v),r.createElement(be.A.Actions,null,r.createElement(K.A,{ref:m,onClick:h,loading:u,floated:"left"},p.M.t("Cancel")),r.createElement(K.A,{negative:!0,onClick:b,loading:u},p.M.t("Delete")))))};function De(e){var t=new URL(e),n=5*(new Date).getMilliseconds();return t.searchParams.set("no-cache",n.toString()),t.toString()}ze.propTypes={onDelete:de().func.isRequired,redirectURL:de().string.isRequired,onError:de().func.isRequired,label:de().string.isRequired,confirmationMessage:de().string.isRequired,id:de().string.isRequired};var je=function(e){var t=e.community,n=e.defaultLogo,a=e.hasLogo,o=e.onError,l=e.logoMaxSize,c=(0,r.useState)(t.links.logo),u=(0,re.A)(c,2),s=u[0],m=u[1],d=(0,r.useState)(!1),h=(0,re.A)(d,2),b=h[0],g=h[1],v=(0,r.useState)(a),y=(0,re.A)(v,2),A=y[0],E=y[1],w=n,C={preventDropOnDocument:!0,onDropAccepted:function(){var e=(0,i.A)(f().mark((function e(n){var r,a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n[0],e.prev=1,a=new te,e.next=5,a.updateLogo(t.id,r);case 5:i=De(s),m(i),g(!0),E(!0),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),o(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}(),onDropRejected:function(e){console.error(e[0].errors)},multiple:!1,noClick:!0,noDrag:!0,noKeyboard:!0,disabled:!1,maxFiles:1,maxSize:5e6,accept:".jpeg,.jpg,.png"},k=function(){var e=(0,i.A)(f().mark((function e(){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new te,e.next=3,n.deleteLogo(t.id);case 3:r=De(s),m(r),g(!0),E(!1);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.createElement(Pe.Ay,C,(function(e){var t=e.getRootProps,n=e.getInputProps,a=e.open;return r.createElement(r.Fragment,null,r.createElement("span",t(),r.createElement("input",n()),r.createElement(pe.A,{as:"h2",size:"small",className:""},p.M.t("Collection profile image")),r.createElement(G.Image,{key:s,src:s,fallbackSrc:w,loadFallbackFirst:!0,fluid:!0,wrapped:!0,rounded:!0,className:"community-logo settings"}),r.createElement(Q.A,{hidden:!0})),r.createElement(K.A,{fluid:!0,icon:!0,labelPosition:"left",type:"button",onClick:a,className:"rel-mt-1 rel-mb-1"},r.createElement(Z.A,{name:"upload"}),p.M.t("Upload new picture")),r.createElement("label",{className:"helptext"},p.M.t("File must be smaller than {{fileSize}}",{fileSize:(0,G.humanReadableBytes)(l,!0)})),A&&r.createElement(ze,{id:"delete-picture-button",label:p.M.t("Delete picture"),confirmationMessage:r.createElement(pe.A,{as:"h2",size:"medium"},p.M.t("Are you sure you want to delete this picture?")),onDelete:k,onError:o}),b&&r.createElement(Y.A,{info:!0,icon:"warning circle",size:"small",content:p.M.t("It may take a few moments for changes to be visible everywhere")}))}))};je.propTypes={community:de().object.isRequired,defaultLogo:de().string.isRequired,hasLogo:de().bool.isRequired,onError:de().func.isRequired,logoMaxSize:de().number.isRequired};const Ne=je;var Ie=n(53196);function Te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(n),!0).forEach((function(t){(0,m.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function qe(e,t,n){return t=(0,u.A)(t),(0,c.A)(e,Ue()?Reflect.construct(t,n||[],(0,u.A)(e).constructor):t.apply(e,n))}function Ue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ue=function(){return!!e})()}var _e=X.Ik({metadata:X.Ik({title:X.Yj().max(250,p.M.t("Maximum number of characters is 2000")),description:X.Yj().max(250,p.M.t("Maximum number of characters is 250")),website:X.Yj().url(p.M.t("Must be a valid URL")),type:X.Ik().shape({id:X.Yj()})})}),Be=function e(t){if(C()(t))return t.map((function(t){return e(t)})).filter((function(e){return O()(e)||P()(e)?e:!S()(e)}));if(D()(t)){var n=T()(t,(function(t){return e(t)}));return _()(n,(function(e){return C()(e)||D()(e)?!S()(e):!R()(e)}))}return P()(t)||O()(t)||t?t:null},Je=function(e){function t(){var e;(0,o.A)(this,t);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=qe(this,t,[].concat(r)),(0,m.A)(e,"state",{error:""}),(0,m.A)(e,"knownOrganizations",{}),(0,m.A)(e,"getInitialValues",(function(){var t,n=e.props.community,r=y()(n,{id:"",slug:"",metadata:{description:"",title:"",curation_policy:"",type:{},website:"",organizations:[],funding:[]},access:{visibility:"public",member_policy:"open",record_policy:"open"}}),a=r.metadata.organizations.map((function(t){return t.id&&(e.knownOrganizations[t.name]=t.id),t.name}));J()(r,"metadata.type.title");var i=function(e){var t=function(e){var t=g()(e);if(null!==e&&void 0!==e&&e.title_l10n&&(t.title=e.title_l10n),e.identifiers){["url"].forEach((function(n){var r=null;e.identifiers.forEach((function(e){e.scheme===n&&(r=e.identifier)})),r&&(t[n]=r)})),delete t.identifiers}return t},n={};return null!==e&&(n=Array.isArray(e)?e.map(t):t(e)),n},o=null===(t=r.ui.funding)||void 0===t?void 0:t.map((function(e){return Le(Le({},e.award&&{award:i(e.award)}),{},{funder:i(e.funder)})})),l=e.props.customFields;return Le(Le({},r=new ue({fieldpath:"custom_fields",deserializedDefault:{},serializedDefault:{},vocabularyFields:l.vocabularies}).deserialize(r)),{},{metadata:Le(Le({},r.metadata),{},{organizations:a,funding:o})})})),(0,m.A)(e,"serializeValues",(function(t){var n,r=function(e){var t=function(e){if(e.id)return{id:e.id};var t=g()(e);return t=q()(t,["identifiers","number","title"]),e.title&&(t.title={en:e.title}),e.url&&(t.identifiers=[{identifier:e.url,scheme:"url"}],delete t.url),t},n={};return null!==e&&(n=Array.isArray(e)?e.map(t):t(e)),n},a=g()(t),i=a.metadata.organizations.map((function(t){var n=e.knownOrganizations[t];return Le(Le({},n&&{id:n}),{},{name:t})})),o=null===(n=a.metadata)||void 0===n||null===(n=n.funding)||void 0===n?void 0:n.map((function(e){return Le(Le({},e.award&&{award:r(e.award)}),{},{funder:r(e.funder)})})),l=e.props.customFields;return a=Le(Le({},a=new ue({fieldpath:"custom_fields",deserializedDefault:{},serializedDefault:{},vocabularyFields:l.vocabularies}).serialize(a)),{},{metadata:Le(Le({},t.metadata),{},{organizations:i,funding:o})}),a=Be(a)})),(0,m.A)(e,"setGlobalError",(function(t){var n=ne(t).message;e.setState({error:n})})),(0,m.A)(e,"onSubmit",function(){var t=(0,i.A)(f().mark((function t(n,r){var a,i,o,l,c,u,s,m;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=r.setSubmitting,i=r.setFieldError,a(!0),o=e.serializeValues(n),l=new te,c=e.props.community,t.prev=5,t.next=8,l.update(c.id,o);case 8:window.location.reload(),t.next=19;break;case 11:if(t.prev=11,t.t0=t.catch(5),"UNMOUNTED"!==t.t0){t.next=15;break}return t.abrupt("return");case 15:u=ne(t.t0),s=u.message,m=u.errors,a(!1),s&&e.setGlobalError(t.t0),m&&m.map((function(e){var t=e.field,n=e.messages;return i(t,n[0])}));case 19:case"end":return t.stop()}}),t,null,[[5,11]])})));return function(e,n){return t.apply(this,arguments)}}()),e}return(0,s.A)(t,e),(0,l.A)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.types,i=t.customFields,o=t.community,l=t.hasLogo,c=t.defaultLogo,u=t.logoMaxSize,s=t.permissions,d=this.state.error;return r.createElement(h.Formik,{initialValues:this.getInitialValues(o),validationSchema:_e,onSubmit:this.onSubmit},(function(t){var f=t.isSubmitting,h=t.isValid,b=t.handleSubmit;return r.createElement(W.A,{onSubmit:b,className:"communities-profile"},r.createElement(Y.A,{hidden:""===d,negative:!0},r.createElement(H.A,{container:!0},r.createElement(H.A.Column,{width:15,textAlign:"left"},r.createElement("strong",null,d)))),r.createElement(H.A,null,r.createElement(H.A.Row,null,r.createElement(H.A.Column,{as:"section",mobile:16,tablet:10,computer:11,className:"rel-pb-2"},r.createElement(G.AccordionField,{includesPaths:["metadata.title","metadata.type.id","metadata.website","metadata.organizations","metadata.description"],label:p.M.t("Basic information"),active:!0},r.createElement("div",{className:"rel-ml-1 rel-mr-1"},r.createElement(G.TextField,{fluid:!0,fieldPath:"metadata.title",label:r.createElement(G.FieldLabel,{htmlFor:"metadata.title",icon:"book",label:p.M.t("Name")})}),r.createElement(Ie.default,{id:"InvenioCommunities.CommunityProfileForm.TextAreaField.MetadataDescription",community:o},r.createElement(G.TextAreaField,{fieldPath:"metadata.description",label:r.createElement(G.FieldLabel,{htmlFor:"metadata.description",icon:"pencil",label:p.M.t("Short description")}),fluid:!0})),r.createElement(Ie.default,{id:"InvenioCommunities.CommunityProfileForm.SelectField.MetadataType",community:o},r.createElement(G.SelectField,{search:!0,clearable:!0,fieldPath:"metadata.type.id",label:r.createElement(G.FieldLabel,{htmlFor:"metadata.type.id",icon:"tag",label:p.M.t("Type")}),options:a.map((function(e){var t;return{value:e.id,text:null!==(t=null===e||void 0===e?void 0:e.title_l10n)&&void 0!==t?t:e.id}}))})),r.createElement(Ie.default,{id:"InvenioCommunities.CommunityProfileForm.TextField.MetadataWebsite",community:o},r.createElement(G.TextField,{fieldPath:"metadata.website",label:r.createElement(G.FieldLabel,{htmlFor:"metadata.website",icon:"chain",label:p.M.t("Website")}),fluid:!0})),r.createElement(Ie.default,{id:"InvenioCommunities.CommunityProfileForm.RemoteSelectField.MetadataOrganizations",community:o},r.createElement(G.RemoteSelectField,{fieldPath:"metadata.organizations",suggestionAPIUrl:"/api/affiliations",suggestionAPIHeaders:{Accept:"application/json"},placeholder:p.M.t("Search for an organization by name"),clearable:!0,multiple:!0,initialSuggestions:E()(o,"metadata.organizations",[]),serializeSuggestions:function(t){return N()(t,(function(t){return e.knownOrganizations.hasOwnProperty(t.name)||(e.knownOrganizations=Le(Le({},e.knownOrganizations),{},(0,m.A)({},t.name,t.id))),{text:t.name,value:t.name,key:t.name}}))},label:r.createElement(G.FieldLabel,{htmlFor:"metadata.organizations",icon:"group",label:p.M.t("Organizations")}),noQueryMessage:p.M.t("Search for organizations..."),allowAdditions:!0,search:function(e,t){return e}})))),r.createElement(Ie.default,{id:"InvenioCommunities.CommunityProfileForm.AccordionField.MetadataFunding",community:o},r.createElement(G.AccordionField,{includesPaths:["metadata.funding"],label:p.M.t("Funding information")},r.createElement("div",{className:"rel-ml-1 rel-mr-1"},r.createElement(V.q,{fieldPath:"metadata.funding",searchConfig:{searchApi:{axios:{headers:{Accept:"application/vnd.inveniordm.v1+json"},url:"/api/awards",withCredentials:!1}},initialQueryState:{sortBy:"bestmatch",sortOrder:"asc",layout:"list",page:1,size:5}},label:p.M.t("Awards"),labelIcon:"money bill alternate outline",deserializeAward:function(e){var t;return Le(Le({title:e.title_l10n,pid:e.pid,number:e.number,funder:null!==(t=e.funder)&&void 0!==t?t:"",id:e.id},e.identifiers&&{identifiers:e.identifiers}),e.acronym&&{acronym:e.acronym})},deserializeFunder:function(e){return Le(Le(Le(Le({id:e.id,name:e.name},e.title_l10n&&{title:e.title_l10n}),e.pid&&{pid:e.pid}),e.country&&{country:e.country}),e.identifiers&&{identifiers:e.identifiers})},computeFundingContents:function(e){var t,n="",r="award";if(e.award&&(t=e.award.title),e.funder){var a,i,o,l,c,u,s=null!==(a=null!==(i=null!==(o=null===(l=e.funder)||void 0===l?void 0:l.name)&&void 0!==o?o:null===(c=e.funder)||void 0===c?void 0:c.title)&&void 0!==i?i:null===(u=e.funder)||void 0===u?void 0:u.id)&&void 0!==a?a:"";n=s,t||(r="funder",t=s,n="")}return{headerContent:t,descriptionContent:n,awardOrFunder:r}}})))),!S()(i.ui)&&r.createElement(G.CustomFields,{config:i.ui,templateLoaders:[function(e){return n(34222)("./".concat(e,".js"))},function(e){return Promise.resolve().then(n.bind(n,81057))}],fieldPathPrefix:"custom_fields"}),r.createElement(Q.A,{hidden:!0}),r.createElement(Q.A,null),r.createElement(K.A,{disabled:!h||f,loading:f,labelPosition:"left",primary:!0,type:"button",icon:!0,onClick:function(e){return b(e)}},r.createElement(Z.A,{name:"save"}),p.M.t("Save"))),r.createElement(H.A.Column,{as:"section",mobile:16,tablet:5,computer:4,floated:"right",className:"logo-upload-column"},r.createElement(Ie.default,{id:"InvenioCommunities.CommunityProfileForm.LogoUploader.ProfilePicture",community:o},r.createElement(Ne,{community:o,hasLogo:l,defaultLogo:c,onError:e.setGlobalError,logoMaxSize:u})))),r.createElement(Ie.default,{id:"InvenioCommunities.CommunityProfileForm.GridRow.DangerZone",community:o},r.createElement(H.A.Row,{className:"danger-zone"},r.createElement(H.A.Column,{as:"section",width:16},r.createElement(Fe,{community:o,onError:e.setGlobalError,permissions:s}))))))}))}}])}(r.Component);Je.propTypes={community:de().object.isRequired,defaultLogo:de().string.isRequired,hasLogo:de().bool.isRequired,logoMaxSize:de().number.isRequired,customFields:de().object.isRequired,types:de().array.isRequired,permissions:de().object.isRequired};const Ve=Je;var Ge=document.getElementById("app"),We=JSON.parse(Ge.dataset.community),Ye=JSON.parse(Ge.dataset.hasLogo),He=JSON.parse(Ge.dataset.types),Qe=JSON.parse(Ge.dataset.logoMaxSize),Ke=JSON.parse(Ge.dataset.customFields),Ze=JSON.parse(Ge.dataset.permissions),Xe=Ie.overrideStore.getAll();a.render(r.createElement(Ie.OverridableContext.Provider,{value:Xe},r.createElement(Ve,{community:We,hasLogo:Ye,defaultLogo:"/static/images/square-placeholder.png",types:He,logoMaxSize:Qe,customFields:Ke,permissions:Ze})),Ge)}},e=>{e.O(0,[402,1057,7655,5373,6267,9777,5941,4218,6932,8102,1751,2900],(()=>{return t=13596,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=invenio-communities-profile-custom.b670fe69680e8ffc90c1.js.map