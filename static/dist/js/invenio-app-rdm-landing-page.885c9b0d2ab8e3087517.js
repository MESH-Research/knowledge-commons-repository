(self.webpackChunkinvenio_assets=self.webpackChunkinvenio_assets||[]).push([[5115],{62513:(e,t,n)=>{"use strict";n.d(t,{i:()=>b});var r=n(64467),a=n(23029),o=n(92901),i=n(56822),c=n(53954),l=n(85501),s=n(96540),u=n(5556),d=n.n(u),m=n(3487),p=n(93682),f=n(59399),h=n(70742);function v(e,t,n){return t=(0,c.A)(t),(0,i.A)(e,A()?Reflect.construct(t,n||[],(0,c.A)(e).constructor):t.apply(e,n))}function A(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(A=function(){return!!e})()}var g=function(e){function t(){return(0,a.A)(this,t),v(this,t,arguments)}return(0,l.A)(t,e),(0,o.A)(t,[{key:"render",value:function(){var e=this.props,t=e.text,n=e.onCopy,r=e.hoverState;return s.createElement(f.CopyToClipboard,{text:t,onCopy:function(){n(t)}},s.createElement(m.A,{className:"copy",basic:!0,icon:"copy","aria-label":h.M.t("Copy to clipboard"),onMouseEnter:r,onMouseLeave:r}))}}])}(s.Component);g.propTypes={text:d().string.isRequired,onCopy:d().func.isRequired,hoverState:d().func},g.defaultProps={hoverState:null};var b=function(e){function t(e){var n;return(0,a.A)(this,t),n=v(this,t,[e]),(0,r.A)(n,"onCopy",(function(){n.setState((function(){return{confirmationPopupIsOpen:!0,confirmationPopupMsg:h.M.t("Copied!")}})),n.delayClosePopup()})),(0,r.A)(n,"delayClosePopup",(function(){var e=setTimeout((function(){n.setState(n.INITIAL_STATE)}),1500);n.setState({stateReset:e})})),(0,r.A)(n,"hoverStateHandler",(function(e){e.persist(),"mouseenter"===e.type&&n.setState({hoverPopupIsOpen:!0}),"mouseleave"===e.type&&n.setState({hoverPopupIsOpen:!1})})),n.INITIAL_STATE={confirmationPopupIsOpen:!1,confirmationPopupMsg:"",hoverPopupIsOpen:!1,stateReset:null},n.state=n.INITIAL_STATE,n}return(0,l.A)(t,e),(0,o.A)(t,[{key:"componentWillUnmount",value:function(){var e=this.state.stateReset;e&&clearTimeout(e)}},{key:"render",value:function(){var e=this.props,t=e.text,n=e.popUpPosition,r=this.state,a=r.confirmationPopupMsg,o=r.confirmationPopupIsOpen,i=r.hoverPopupIsOpen;return t&&s.createElement(p.A,{role:"alert",open:i||o,content:a||h.M.t("Copy to clipboard"),inverted:!!a,position:n,size:"mini",trigger:s.createElement(g,{text:t,onCopy:this.onCopy,hoverState:this.hoverStateHandler})})}}])}(s.Component);b.propTypes={popUpPosition:d().string,text:d().string},b.defaultProps={popUpPosition:"right center",text:""}},33020:(e,t,n)=>{"use strict";var r=n(96540),a=n(40961),o=n(23029),i=n(92901),c=n(56822),l=n(53954),s=n(85501),u=n(70742),d=n(1489),m=n(3487),p=n(76217),f=n(87395),h=n(10467),v=n(80296),A=n(54756),g=n.n(A),b=n(81057),E=n(5556),y=n.n(E),C=function(e){var t=e.recid,n=e.onError,a=(0,r.useState)(!1),o=(0,v.A)(a,2),i=o[0],c=o[1],l=function(){var e=(0,h.A)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(!0),e.prev=1,e.next=4,b.http.post("/api/records/".concat(t,"/draft"),{},{headers:{"Content-Type":"application/json",Accept:"application/vnd.inveniordm.v1+json"}});case 4:window.location="/uploads/".concat(t),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),c(!1),n(e.t0.response.data.message);case 11:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(){return e.apply(this,arguments)}}();return r.createElement(m.A,{fluid:!0,className:"warning",size:"medium",onClick:l,loading:i,icon:!0,labelPosition:"left"},r.createElement(p.A,{name:"edit"}),u.M.t("Edit"))};C.propTypes={recid:y().string.isRequired,onError:y().func.isRequired};var k=n(93682),R=n(64467),S=n(98591),M=n(27089),O=n(48423),w=n(6549),x=n(45458),q=n(62193),N=n.n(q),_=n(53959),P=n(92257),D=n(34667);function T(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,j()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function j(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(j=function(){return!!e})()}var I=function(e){function t(e){var n;return(0,o.A)(this,t),(n=T(this,t,[e])).state={description:void 0,expiresAt:void 0,permission:$[0].key},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.permission,a=t.expiresAt,o=t.description,i=this.props,c=i.handleCreation,l=i.loading;return r.createElement(_.A.Row,null,r.createElement(_.A.Cell,{width:16},r.createElement(d.A,null,r.createElement(d.A.Column,{width:4},r.createElement(P.A,{id:"access-request-description",onChange:function(t,n){return e.setState({description:n.value})},fluid:!0}),r.createElement("label",{htmlFor:"access-request-description",className:"helptext mb-0 mt-10"},u.M.t("Short name for your link (optional)."))),r.createElement(d.A.Column,{width:4},r.createElement(P.A,{id:"access-request-expires-at",onChange:function(t,n){e.setState({expiresAt:n.value})},fluid:!0,placeholder:u.M.t("Expiration date format: YYYY-MM-DD")}),r.createElement("label",{htmlFor:"access-request-expires-at",className:"helptext mb-0 mt-10"},u.M.t("Expiration date: YYYY-MM-DD or never if blank (optional)."))),r.createElement(d.A.Column,{width:4},r.createElement(D.A,{placeholder:u.M.t("Select permissions"),fluid:!0,selection:!0,onChange:function(t,n){return e.setState({permission:n.value})},options:$,defaultValue:n})),r.createElement(d.A.Column,{width:4,textAlign:"right"},r.createElement(m.A,{onClick:function(){return c(n,a,o)},icon:!0,loading:l,disabled:l,labelPosition:"left",positive:!0},r.createElement(p.A,{name:"code branch"}),u.M.t("Create a new link"))))))}}])}(r.Component);I.propTypes={handleCreation:y().func.isRequired,loading:y().bool.isRequired};var B=n(38992),U=n(88860),L=n(60996);function F(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,z()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function z(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(z=function(){return!!e})()}var H=function(e){var t;return(null===e||void 0===e||null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)||(null===e||void 0===e?void 0:e.message)},V=function(e){function t(e){var n;return(0,o.A)(this,t),n=F(this,t,[e]),(0,R.A)(n,"handleUpdate",function(){var e=(0,h.A)(g().mark((function e(t){var r,a,o,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.props,a=r.record,o=r.result,i={permission:t},n.setState({loading:!0,actionSuccess:!1}),n.cancellableAction=(0,b.withCancel)(b.http.patch("".concat(a.links.access_links,"/").concat(o.id),i)),e.prev=4,e.next=7,n.cancellableAction.promise;case 7:n.setState({loading:!1,actionSuccess:!0,error:void 0}),e.next=16;break;case 10:if(e.prev=10,e.t0=e.catch(4),"UNMOUNTED"!==e.t0){e.next=14;break}return e.abrupt("return");case 14:n.setState({loading:!1,actionSuccess:!1,error:H(e.t0)}),console.error(e.t0);case 16:case"end":return e.stop()}}),e,null,[[4,10]])})));return function(t){return e.apply(this,arguments)}}()),n.state={error:void 0,loading:!1,actionSuccess:void 0},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"componentWillUnmount",value:function(){this.cancellableAction&&this.cancellableAction.cancel()}},{key:"render",value:function(){var e=this,t=this.props.result,n=this.state,a=n.loading,o=n.actionSuccess,i=n.error;return r.createElement("div",{className:"flex align-items-center access-dropdown-container"},r.createElement(D.A,{placeholder:u.M.t("Select permissions"),fluid:!0,loading:a,selection:!0,options:$,onChange:function(t,n){return e.handleUpdate(n.value)},defaultValue:t.permission}),r.createElement("div",{className:"ml-5 action-status-container"},o&&r.createElement(U.B,{timeOutDelay:3e3,show:o}),i&&r.createElement(L.r,{error:i})))}}])}(r.Component);V.propTypes={result:y().object.isRequired,record:y().object.isRequired};var J=n(92516),Y=n.n(J),W=n(2543),X=function(e){var t=e.result,n=e.record,a=e.fetchData,o=(0,r.useState)(!1),i=(0,v.A)(o,2),c=i[0],l=i[1],s=(0,r.useState)(!1),d=(0,v.A)(s,2),f=d[0],A=d[1],E=void 0;(0,r.useEffect)((function(){return function(){E&&E.cancel()}}),[E]);var y=function(){var e=(0,h.A)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A(!0),E=(0,b.withCancel)(b.http.delete("".concat(n.links.access_links,"/").concat(t.id))),e.prev=2,e.next=5,E.promise;case 5:A(!1),a(),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),A(!1),console.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(){return e.apply(this,arguments)}}(),C=r.createRef();(0,r.useEffect)((function(){var e;null===(e=C.current)||void 0===e||e.focus()}),[C]),(0,r.useEffect)((function(){var e=setTimeout((function(){l(!1)}),1500);return function(){clearTimeout(e)}}),[c]);return r.createElement(_.A.Row,{key:t.id},r.createElement(_.A.Cell,{width:3,"data-label":"Link title"},(0,W.isEmpty)(t.description)?"-":Y()(t.description,{length:60})),r.createElement(_.A.Cell,{width:3,"data-label":"Created"},(0,B.$)(t.created_at)),r.createElement(_.A.Cell,{width:3,"data-label":"Expires at"},(0,W.isEmpty)(t.expires_at)?u.M.t("Never"):"".concat((0,B.$)(t.expires_at)," (").concat(t.expires_at,")")),r.createElement(_.A.Cell,{width:3,"data-label":"Access"},r.createElement(V,{record:n,result:t})),r.createElement(_.A.Cell,{width:4},r.createElement(m.A,{loading:f,disabled:f,onClick:y,icon:!0,labelPosition:"left",negative:!0,size:"small"},r.createElement(p.A,{name:"trash"}),u.M.t("Delete")),r.createElement(k.A,{position:"top center",content:u.M.t("Copied!"),inverted:!0,open:c,on:"click",size:"small",trigger:r.createElement(m.A,{ref:C,onClick:function(){return function(){var e="".concat(n.links.self_html,"?token=").concat(t.token);navigator.clipboard.writeText(e),l(!0)}(null===t||void 0===t||t.id)},"aria-label":u.M.t("Copy link"),size:"small",icon:!0,labelPosition:"left"},r.createElement(p.A,{name:"copy outline"}),u.M.t("Copy link"))})))};function G(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,K()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function K(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(K=function(){return!!e})()}X.propTypes={result:y().object.isRequired,record:y().object.isRequired,fetchData:y().func.isRequired};var $=[{key:"view",text:u.M.t("Can view"),value:"view"},{key:"preview",text:u.M.t("Can preview"),value:"preview"},{key:"edit",text:u.M.t("Can edit"),value:"edit"}],Q=function(e){function t(e){var n;return(0,o.A)(this,t),n=G(this,t,[e]),(0,R.A)(n,"errorMessage",(function(){var e,t,a=n.state.error,o=(null===a||void 0===a||null===(e=a.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.message)||(null===a||void 0===a?void 0:a.message),i=null===a||void 0===a||null===(t=a.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.errors;return r.createElement(f.A,{className:"mb-30",negative:!0},o,i&&i.map((function(e){return r.createElement(f.A.Item,{key:e.field},r.createElement("b",null,e.field.charAt(0).toUpperCase()+e.field.slice(1).replace("_"," ")),": ",n.renderErrorMessages(e.messages))})))})),(0,R.A)(n,"handleCreation",function(){var e=(0,h.A)(g().mark((function e(t,r,a){var o,i,c,l;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.props,i=o.fetchData,c=o.record,n.setState({loading:!0}),e.prev=2,l={permission:t,expires_at:r,description:a},n.cancellableAction=(0,b.withCancel)(b.http.post(c.links.access_links,l)),e.next=7,n.cancellableAction.promise;case 7:i(),n.setState({loading:!1,error:void 0}),e.next=17;break;case 11:if(e.prev=11,e.t0=e.catch(2),"UNMOUNTED"!==e.t0){e.next=15;break}return e.abrupt("return");case 15:n.setState({loading:!1,error:e.t0}),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t,n,r){return e.apply(this,arguments)}}()),n.state={loading:!1,error:void 0},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"componentWillUnmount",value:function(){this.cancellableAction&&this.cancellableAction.cancel()}},{key:"renderErrorMessages",value:function(e){var t=(0,x.A)(new Set(e));return 1===t.length?e[0]:r.createElement("ul",null,t.map((function(e){return r.createElement("li",{key:e},e)})))}},{key:"render",value:function(){var e=this.props,t=e.results,n=e.record,a=e.fetchData,o=this.state,i=o.loading,c=o.error;return r.createElement(r.Fragment,null,c&&this.errorMessage(),r.createElement(_.A,{className:"fixed-header"},r.createElement(_.A.Header,null,r.createElement(_.A.Row,null,r.createElement(_.A.HeaderCell,{"data-label":"Link title",width:3},u.M.t("Link title")),r.createElement(_.A.HeaderCell,{"data-label":"Created",width:3},u.M.t("Created")),r.createElement(_.A.HeaderCell,{"data-label":"Expires at",width:3},u.M.t("Expires")),r.createElement(_.A.HeaderCell,{"data-label":"Access",width:3},u.M.t("Access")),r.createElement(_.A.HeaderCell,{width:4}))),r.createElement(_.A.Body,null,i?r.createElement(w.A,null):N()(t)?r.createElement(_.A.Row,{textAlign:"center"},r.createElement("p",{className:"mt-10"},r.createElement("i",null,r.createElement("h5",null,u.M.t("This record has no links generated yet."))))):t.map((function(e){return r.createElement(X,{key:e.id,result:e,record:n,fetchData:a})})))),r.createElement(_.A,{color:"green"},r.createElement(I,{handleCreation:this.handleCreation,loading:i})))}}])}(r.Component);function Z(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,ee()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function ee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ee=function(){return!!e})()}Q.propTypes={results:y().array.isRequired,record:y().object.isRequired,fetchData:y().func.isRequired};var te=function(e){function t(e){var n;return(0,o.A)(this,t),n=Z(this,t,[e]),(0,R.A)(n,"fetchData",(0,h.A)(g().mark((function e(){var t,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props.record,n.setState({loading:!0}),e.prev=2,n.cancellableAction=(0,b.withCancel)(b.http.get(t.links.access_links)),e.next=6,n.cancellableAction.promise;case 6:r=e.sent,n.setState({loading:!1,error:void 0,results:r.data.hits.hits}),e.next=16;break;case 10:if(e.prev=10,e.t0=e.catch(2),"UNMOUNTED"!==e.t0){e.next=14;break}return e.abrupt("return");case 14:n.setState({loading:!1,error:e.t0}),console.error(e.t0);case 16:case"end":return e.stop()}}),e,null,[[2,10]])})))),n.state={results:void 0,loading:!1,error:void 0},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"componentWillUnmount",value:function(){this.cancellableAction&&this.cancellableAction.cancel()}},{key:"render",value:function(){var e=this.state,t=e.results,n=e.loading,a=e.error,o=this.props,i=o.record,c=o.handleClose;return r.createElement(r.Fragment,null,a&&a,r.createElement(O.A.Content,null,n?r.createElement(w.A,null):r.createElement(Q,{results:t,record:i,fetchData:this.fetchData})),r.createElement(O.A.Actions,{className:"ui clearing segment"},r.createElement(m.A,{size:"small",onClick:c,content:u.M.t("Cancel"),icon:"remove",className:"left floated clearing"})))}}])}(r.Component);te.propTypes={record:y().string.isRequired,handleClose:y().func.isRequired};var ne=n(61448),re=n.n(ne);function ae(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,oe()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function oe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(oe=function(){return!!e})()}var ie=function(e){function t(e){var n;(0,o.A)(this,t),n=ae(this,t,[e]),(0,R.A)(n,"handleOnChange",(function(e){var t=e.data;e.formikProps.form.setFieldValue("secret_link_expiration",t.value)}));var r=e.expirationOptions;return n.expirationOptions=r,n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this.props,t=e.inline,n=e.expirationOptions,a=e.value,o=a?a.toString():n[0].value;return r.createElement(b.SelectField,{label:u.M.t("Link expiration"),inline:t,fieldPath:"secret_link_expiration",options:this.expirationOptions,onChange:this.handleOnChange,value:o,defaultValue:n[0]})}}])}(r.Component);ie.propTypes={expirationOptions:y().arrayOf(y().shape({key:y().string.isRequired,text:y().string.isRequired,value:y().string.isRequired})),inline:y().bool,value:y().string},ie.defaultProps={expirationOptions:[{key:0,text:u.M.t("Never"),value:"0"},{key:30,text:u.M.t("In 1 month"),value:"30"},{key:60,text:u.M.t("In 2 months"),value:"60"},{key:180,text:u.M.t("In 6 months"),value:"180"},{key:365,text:u.M.t("In 1 year"),value:"365"}],inline:!1,value:void 0};var ce=n(80501),le=n(50363),se=n(36713),ue=n(17684),de=n(15941),me=n(58156),pe=n.n(me);function fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function he(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,ve()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function ve(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ve=function(){return!!e})()}var Ae=function(e){function t(e){var n;return(0,o.A)(this,t),n=he(this,t,[e]),(0,R.A)(n,"accessRequestSchema",de.Ik({allow_user_requests:de.lc(),allow_guest_requests:de.lc(),accept_conditions_text:de.Yj().nullable(),secret_link_expiration:de.Yj()})),(0,R.A)(n,"handleSubmit",function(){var e=(0,h.A)(g().mark((function e(t){var r,a,o,i,c,l;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({loading:!0,actionSuccess:!1}),r=n.props,a=r.record,o=r.successCallback,i={allow_user_requests:t.allow_user_requests,allow_guest_requests:t.allow_guest_requests,accept_conditions_text:t.accept_conditions_text,secret_link_expiration:t.secret_link_expiration},n.cancellableAction=(0,b.withCancel)(b.http.put(a.links.access,i)),e.prev=4,e.next=7,n.cancellableAction.promise;case 7:c=e.sent,n.setState({loading:!1,actionSuccess:!0,error:void 0}),o(c.data),e.next=18;break;case 12:if(e.prev=12,e.t0=e.catch(4),"UNMOUNTED"!==e.t0){e.next=16;break}return e.abrupt("return");case 16:n.setState({error:(null===e.t0||void 0===e.t0||null===(l=e.t0.response)||void 0===l||null===(l=l.data)||void 0===l?void 0:l.message)||(null===e.t0||void 0===e.t0?void 0:e.t0.message),loading:!1,actionSuccess:!1}),console.error(e.t0);case 18:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t){return e.apply(this,arguments)}}()),(0,R.A)(n,"initFormValues",(function(){var e=n.props.record.parent.access.settings;return re()(e,"secret_link_expiration")||(e.secret_link_expiration=0),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(n),!0).forEach((function(t){(0,R.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e)})),n.state={loading:!1,error:void 0,actionSuccess:void 0},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"componentWillUnmount",value:function(){this.cancellableAction&&this.cancellableAction.cancel()}},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.error,a=e.actionSuccess,o=this.props.handleClose;return r.createElement(ue.Formik,{onSubmit:this.handleSubmit,enableReinitialize:!0,initialValues:this.initFormValues(),validationSchema:this.accessRequestSchema},(function(e){var i=e.values,c=e.handleSubmit;return r.createElement(r.Fragment,null,r.createElement(O.A.Content,null,n&&r.createElement(b.ErrorMessage,{header:u.M.t("Unable to change the access request settings."),content:u.M.t(n),icon:"exclamation",className:"text-align-left",negative:!0}),r.createElement(d.A,null,r.createElement(ce.A,null,r.createElement(d.A,null,r.createElement(d.A.Row,null,r.createElement(d.A.Column,{width:16},r.createElement(ce.A.Field,null,r.createElement(b.RadioField,{checked:pe()(i,"allow_user_requests"),control:le.A,fieldPath:"allow_user_requests",label:u.M.t("Allow authenticated users to request access to restricted files."),onChange:function(e){var t=e.data;e.formikProps.form.setFieldValue("allow_user_requests",t.checked)}})),r.createElement(ce.A.Field,null,r.createElement(b.RadioField,{checked:pe()(i,"allow_guest_requests"),control:le.A,fieldPath:"allow_guest_requests",label:u.M.t("Allow non-authenticated users to request access to restricted files."),onChange:function(e){var t=e.data;e.formikProps.form.setFieldValue("allow_guest_requests",t.checked)}})),r.createElement("label",{className:"helptext mb-0 mt-10"},u.M.t("Enable users and guests to request access to your record's files. When access is requested by someone, you will get an e-mail asking for approval. After you approve a request, users will be granted access and guests will receive a secret link.")))),r.createElement(d.A.Row,null,r.createElement(d.A.Column,null,r.createElement("h5",null,u.M.t("Accept conditions")),r.createElement("label",{className:"helptext mb-0 mt-10"},u.M.t("Optional. Specify conditions under which you approve access. This message will be visible for any user when requesting access to this record.")),r.createElement(ce.A.Field,null,r.createElement(b.RichInputField,{fieldPath:"accept_conditions_text"}))))),r.createElement("h5",null,u.M.t("Advanced options")),r.createElement(se.A,null),r.createElement(d.A,null,r.createElement(d.A.Row,null,r.createElement(d.A.Column,{width:3},r.createElement(ce.A.Field,null,r.createElement(ie,{inline:!0,value:i.secret_link_expiration})))))),r.createElement(d.A.Row,null,r.createElement(d.A.Column,null,r.createElement("br",null))))),r.createElement(O.A.Actions,null,a&&r.createElement(U.B,{className:"ml-10",timeOutDelay:3e3,show:a}),r.createElement(m.A,{size:"small",onClick:o,floated:"left",content:u.M.t("Cancel"),icon:"remove"}),r.createElement(m.A,{size:"small",labelPosition:"left",icon:"checkmark",primary:!0,content:u.M.t("Save"),onClick:function(e){return c(e)},loading:t,disabled:t})))}))}}])}(r.Component);Ae.propTypes={record:y().string.isRequired,successCallback:y().func.isRequired,handleClose:y().func.isRequired};var ge=n(23848),be=n(28085);function Ee(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,ye()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function ye(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ye=function(){return!!e})()}var Ce=function(e){function t(e){var n;return(0,o.A)(this,t),n=Ee(this,t,[e]),(0,R.A)(n,"handleDelete",(0,h.A)(g().mark((function e(){var t,r,a,o,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props,r=t.record,a=t.result,o=t.setError,n.setState({loading:!0}),i=(0,b.withCancel)(b.http.delete("".concat(r.links.access_users,"/").concat(a.id))),e.prev=3,e.next=6,i.promise;case 6:n.setState({loading:!1,success:!0}),n.handleSuccess(a.id),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(3),n.setState({loading:!1}),console.error(e.t0),o(e.t0);case 15:case"end":return e.stop()}}),e,null,[[3,10]])})))),(0,R.A)(n,"handleSuccess",(function(e){(0,n.props.deleteSuccessCallback)(e)})),n.state={loading:!1,success:void 0},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this.props,t=e.result,n=e.permissions,a=this.state,o=a.loading,i=a.success,c=t.expanded.subject;return r.createElement(_.A.Row,null,r.createElement(_.A.Cell,null,r.createElement(d.A,{textAlign:"left",verticalAlign:"middle"},r.createElement(d.A.Column,null,r.createElement(ge.A,{className:c.is_current_user?"flex align-no-checkbox":"flex",key:t.id},r.createElement(b.Image,{src:c.links.avatar,avatar:!0,className:c.is_current_user?"":"rel-ml-1",alt:""}),r.createElement(ge.A.Content,{className:"ml-10"},r.createElement(ge.A.Header,{className:"flex align-items-center ".concat(c.description?"":"mt-5")},r.createElement("b",{className:"mr-10"},c.profile.full_name||c.username),c.is_current_user&&r.createElement(be.A,{size:"tiny",className:"primary"},u.M.t("You"))),c.profile.affiliations&&r.createElement(ge.A.Meta,null,c.profile.affiliations)))))),r.createElement(_.A.Cell,{"data-label":u.M.t("Access")},t.permission),r.createElement(_.A.Cell,{"data-label":u.M.t("Actions"),textAlign:"right"},r.createElement("div",null,n.can_manage&&r.createElement(r.Fragment,null,i&&r.createElement(U.B,{timeOutDelay:3e3,show:i}),r.createElement(m.A,{size:"small",labelPosition:"left",icon:"user delete",className:"fluid-computer-only",compact:!0,negative:!0,disabled:o,loading:o,content:u.M.t("Remove access"),onClick:this.handleDelete})))))}}])}(r.Component);Ce.propTypes={record:y().object.isRequired,result:y().object.isRequired,permissions:y().object.isRequired,deleteSuccessCallback:y().func.isRequired,setError:y().func.isRequired};var ke=function(e){function t(){return(0,o.A)(this,t),Ee(this,t,arguments)}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this.props,t=e.results,n=e.fetchData,a=e.record,o=e.permissions,i=e.setError;return r.createElement(_.A,null,r.createElement(_.A.Header,null,r.createElement(_.A.Row,null,r.createElement(_.A.HeaderCell,{"data-label":"User",width:4},u.M.t("People with access")),r.createElement(_.A.HeaderCell,{"data-label":"Access",width:3},u.M.t("Access")),r.createElement(_.A.HeaderCell,{width:4}))),r.createElement(_.A.Body,null,t.map((function(e){return r.createElement(Ce,{key:e.id,result:e,record:a,permissions:o,deleteSuccessCallback:n,setError:i})}))))}}])}(r.Component);function Re(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,Se()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function Se(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Se=function(){return!!e})()}ke.propTypes={record:y().object.isRequired,results:y().array.isRequired,permissions:y().object.isRequired,fetchData:y().func.isRequired,setError:y().func.isRequired};var Me=function(e){function t(e){var n;return(0,o.A)(this,t),n=Re(this,t,[e]),(0,R.A)(n,"setError",(function(e){n.setState({error:e})})),(0,R.A)(n,"fetchData",(0,h.A)(g().mark((function e(){var t,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props.record,n.setState({loading:!0}),e.prev=2,n.cancellableAction=(0,b.withCancel)(b.http.get("".concat(t.links.access_users,"?expand=true"))),e.next=6,n.cancellableAction.promise;case 6:r=e.sent,n.setState({loading:!1,error:void 0,results:r.data.hits.hits}),e.next=16;break;case 10:if(e.prev=10,e.t0=e.catch(2),"UNMOUNTED"!==e.t0){e.next=14;break}return e.abrupt("return");case 14:n.setState({loading:!1,error:e.t0}),console.error(e.t0);case 16:case"end":return e.stop()}}),e,null,[[2,10]])})))),n.state={results:void 0,loading:!1,error:void 0},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"componentWillUnmount",value:function(){this.cancellableAction&&this.cancellableAction.cancel()}},{key:"render",value:function(){var e=this.props,t=e.record,n=e.handleClose,a=e.permissions,o=this.state,i=o.results,c=o.loading,l=o.error;return r.createElement(r.Fragment,null,l&&l,r.createElement(O.A.Content,null,c&&r.createElement(w.A,{isLoading:!0,active:!0}),!c&&!N()(i)&&r.createElement(ke,{permissions:a,results:i,record:t,fetchData:this.fetchData,setError:this.setError}),N()(i)&&r.createElement(M.A,{className:"mt-10",textAlign:"center"},r.createElement("h5",null,u.M.t("No user has access to this record yet.")))),r.createElement(O.A.Actions,{className:"ui clearing segment"},r.createElement(m.A,{size:"small",onClick:n,floated:"left",content:u.M.t("Cancel"),icon:"remove"})))}}])}(r.Component);function Oe(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,we()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function we(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(we=function(){return!!e})()}Me.propTypes={record:y().object.isRequired,handleClose:y().func.isRequired,permissions:y().object.isRequired};var xe=function(e){function t(e){var n;(0,o.A)(this,t),n=Oe(this,t,[e]),(0,R.A)(n,"handleRecordUpdate",(function(e){n.setState({record:e})})),(0,R.A)(n,"panes",(function(e,t,a){var o=n.props.handleClose;return[{menuItem:{icon:"users",content:"People"},pane:r.createElement(S.A.Pane,{key:"accessUsers",as:M.A},r.createElement(Me,{record:e,handleClose:o,permissions:a,successCallback:n.handleRecordUpdate}))},{menuItem:{icon:"linkify",content:"Links"},pane:r.createElement(S.A.Pane,{key:"accessLinks",as:M.A},r.createElement(te,{record:e,accessLinksSearchConfig:t,handleClose:o}))},{menuItem:{icon:"cog",content:"Access requests"},pane:r.createElement(S.A.Pane,{key:"accessRequests",as:M.A},r.createElement(Ae,{record:e,handleClose:o,successCallback:n.handleRecordUpdate}))}]}));var a=n.props.record;return n.state={record:a},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this.props,t=e.open,n=e.handleClose,a=e.accessLinksSearchConfig,o=e.permissions,i=this.state.record;return r.createElement(O.A,{open:t,closeIcon:!0,onClose:n,className:"share-modal",role:"dialog","aria-labelledby":"access-link-modal-header","aria-modal":"true","tab-index":"-1",size:"large",closeOnDimmerClick:!1},r.createElement(O.A.Header,{as:"h2",id:"access-link-modal-header"},r.createElement(p.A,{name:"share square"}),u.M.t("Share access")),r.createElement(S.A,{menu:{secondary:!0,pointing:!0},panes:this.panes(i,a,o),renderActiveOnly:!1}))}}])}(r.Component);xe.propTypes={record:y().object.isRequired,open:y().bool.isRequired,handleClose:y().func.isRequired,accessLinksSearchConfig:y().object.isRequired,permissions:y().object.isRequired};var qe=function(e){var t=e.disabled,n=e.record,a=e.accessLinksSearchConfig,o=e.permissions,i=(0,r.useState)(!1),c=(0,v.A)(i,2),l=c[0],s=c[1];return r.createElement(r.Fragment,null,r.createElement(k.A,{content:u.M.t("You don't have permissions to share this record."),disabled:!t,trigger:r.createElement(m.A,{fluid:!0,onClick:function(){return s(!0)},disabled:t,primary:!0,size:"medium","aria-haspopup":"dialog",icon:!0,labelPosition:"left"},r.createElement(p.A,{name:"share square"}),u.M.t("Share"))}),r.createElement(xe,{open:l,handleClose:function(){return s(!1)},record:n,permissions:o,accessLinksSearchConfig:a}))};qe.propTypes={disabled:y().bool,record:y().object.isRequired,accessLinksSearchConfig:y().object.isRequired,permissions:y().object.isRequired},qe.defaultProps={disabled:!1};var Ne=n(93532),_e=n(53196),Pe=function(e){var t=e.recid,n=e.recordOwnerUsername;return r.createElement(D.A,{fluid:!0,text:u.M.t("Manage"),icon:"cog",floating:!0,labeled:!0,button:!0,className:"icon text-align-center"},r.createElement(D.A.Menu,null,r.createElement(D.A.Item,{as:"a",href:"/administration/records?q=id:".concat(t),target:"_blank",key:"manage_record",text:u.M.t("Manage record")}),r.createElement(D.A.Item,{as:"a",href:"/administration/users?q=username:".concat(n),target:"_blank",key:"manage_user",text:u.M.t("Manage user")})))};function De(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,Te()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function Te(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Te=function(){return!!e})()}Pe.propTypes={recid:y().string.isRequired,recordOwnerUsername:y().string.isRequired};var je=function(e){function t(e){var n;return(0,o.A)(this,t),(n=De(this,t,[e])).state={error:""},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.record,a=t.permissions,o=t.isDraft,i=t.isPreviewSubmissionRequest,c=t.currentUserId,l=t.accessLinksSearchConfig,s=t.recordOwnerUsername,h=this.state.error,v=n.id,A=function(t){console.error(t),e.setState({error:t})};return r.createElement(d.A,{columns:1,className:"record-management"},a.can_moderate&&r.createElement(d.A.Column,{className:"pb-5"},r.createElement(Pe,{recid:v,recordOwnerUsername:s})),a.can_edit&&!o&&r.createElement(d.A.Column,{className:a.can_manage?"pb-5 pt-5":"pb-5"},r.createElement(C,{recid:v,onError:A})),i&&o&&r.createElement(d.A.Column,{className:"pb-20"},r.createElement(m.A,{fluid:!0,className:"warning",size:"medium",onClick:function(){return window.location="/uploads/".concat(v)},icon:!0,labelPosition:"left"},r.createElement(p.A,{name:"edit"}),u.M.t("Edit"))),!i&&r.createElement(r.Fragment,null,r.createElement(d.A.Column,{className:"pt-5 pb-5"},r.createElement(Ne.z4,{fluid:!0,size:"medium",record:n,onError:A,disabled:!a.can_new_version})),r.createElement(d.A.Column,{className:"pt-5"},a.can_manage&&r.createElement(qe,{disabled:!a.can_update_draft,record:n,accessLinksSearchConfig:l,permissions:a}))),r.createElement(_e.default,{id:"InvenioAppRdm.RecordLandingPage.RecordManagement.container",isPreviewSubmissionRequest:i,record:n,currentUserId:c}),h&&r.createElement(d.A.Row,{className:"record-management"},r.createElement(d.A.Column,null,r.createElement(f.A,{negative:!0},h))))}}])}(r.Component);je.propTypes={record:y().object.isRequired,permissions:y().object.isRequired,isDraft:y().bool.isRequired,isPreviewSubmissionRequest:y().bool.isRequired,currentUserId:y().string.isRequired,recordOwnerUsername:y().object.isRequired,accessLinksSearchConfig:y().object.isRequired};var Ie=n(58168),Be=n(27859),Ue=n(24941),Le=n(52822),Fe=function(e){return{id:e.id,parent:e.parent,parent_id:e.parent.id,publication_date:e.ui.publication_date_l10n_medium,version:e.ui.version,links:e.links,pids:e.pids,new_draft_parent_doi:e.ui.new_draft_parent_doi}},ze=function(e){var t=e.item,n=e.activeVersion,a=pe()(t.pids,"doi.identifier","");return r.createElement(Be.A.Item,(0,Ie.A)({key:t.id},n&&{className:"version active"}),r.createElement(Be.A.Content,{floated:"left"},n?r.createElement("span",null,u.M.t("Version {{version}}",{version:t.version})):r.createElement("a",{href:"/records/".concat(t.id)},u.M.t("Version {{version}}",{version:t.version})),a&&r.createElement("a",{href:"https://doi.org/".concat(a),className:"doi"+(n?" text-muted-darken":" text-muted")},a)),r.createElement(Be.A.Content,{floated:"right"},r.createElement("small",{className:n?"text-muted-darken":"text-muted"},t.publication_date)))};ze.propTypes={item:y().object.isRequired,activeVersion:y().bool.isRequired};var He=function(){return r.createElement(f.A,{info:!0,className:"no-border-radius m-0"},r.createElement(f.A.Header,null,r.createElement(p.A,{name:"eye"}),u.M.t("Preview")),r.createElement("p",null,u.M.t("Only published versions are displayed.")))},Ve=function(e){var t,n=e.record,a=e.isPreview,o=Fe(n),i=null===o||void 0===o||null===(t=o.parent)||void 0===t||null===(t=t.pids)||void 0===t||null===(t=t.doi)||void 0===t?void 0:t.identifier,c=null===o||void 0===o?void 0:o.new_draft_parent_doi,l=o.id,s=(0,r.useState)(!0),m=(0,v.A)(s,2),p=m[0],f=m[1],A=(0,r.useState)(null),E=(0,v.A)(A,2),y=E[0],C=E[1],k=(0,r.useState)(!1),R=(0,v.A)(k,2),S=R[0],M=R[1],O=(0,r.useState)({}),w=(0,v.A)(O,2),x=w[0],q=w[1],N=function(){var e=(0,h.A)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.http.get("".concat(o.links.versions,"?size=").concat(5,"&sort=version&allversions=true"),{headers:{Accept:"application/vnd.inveniordm.v1+json"},withCredentials:!0});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=(0,b.withCancel)(N());(0,r.useEffect)((function(){function e(){return e=(0,h.A)(g().mark((function e(){var t,n,r,a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.promise;case 3:t=e.sent,n=t.data.hits,r=n.hits,a=n.total,r=r.map(Fe),M(r.some((function(e){return e.id===l}))),q({hits:r,total:a}),f(!1),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),"UNMOUNTED"!==e.t0&&(C(u.M.t("An error occurred while fetching the versions.")),f(!1));case 14:case"end":return e.stop()}}),e,null,[[0,11]])}))),e.apply(this,arguments)}return function(){e.apply(this,arguments)}(),function(){null===_||void 0===_||_.cancel()}}),[]);return p?a?r.createElement(He,null):r.createElement(r.Fragment,null,r.createElement("div",{className:"rel-p-1"}),r.createElement(Ue.A,{className:"rel-ml-1 rel-mr-1"},r.createElement(Ue.A.Header,null,r.createElement(Ue.A.Line,null),r.createElement(Ue.A.Line,null),r.createElement(Ue.A.Line,null)))):y?r.createElement(b.ErrorMessage,{className:"rel-mr-1 rel-ml-1",content:u.M.t(y),negative:!0}):r.createElement(Be.A,{divided:!0},a?r.createElement(He,null):null,x.hits.map((function(e){return r.createElement(ze,{key:e.id,item:e,activeVersion:e.id===l})})),!S&&r.createElement(r.Fragment,null,r.createElement(se.A,{horizontal:!0},"..."),r.createElement(ze,{item:o,activeVersion:!0})),x.total>1&&r.createElement(d.A,{className:"mt-0"},r.createElement(d.A.Row,{centered:!0},r.createElement("a",{href:"/search?q=parent.id:".concat(o.parent_id,"&sort=version&f=allversions:true"),className:"font-small"},u.M.t("View all {{count}} versions",{count:x.total})))),i?r.createElement(Be.A.Item,{className:"parent-doi pr-0"},r.createElement(Be.A.Content,{floated:"left"},r.createElement(Le.x,null,r.createElement("p",{className:"text-muted"},r.createElement("strong",null,"Cite all versions?")," You can cite all versions by using the DOI"," ",r.createElement("a",{href:o.links.parent_doi},i),". This DOI represents all versions, and will always resolve to the latest one. ",r.createElement("a",{href:"/help/versioning"},"Read more"),".")))):c?r.createElement(Be.A.Item,{className:"parent-doi pr-0"},r.createElement(Be.A.Content,{floated:"left"},r.createElement(Le.x,null,r.createElement("p",{className:"text-muted"},r.createElement("strong",null,"Cite all versions?")," You can cite all versions by using the DOI ",c,". The DOI is registered when the first version is published. ",r.createElement("a",{href:"/help/versioning"},"Read more"),".")))):null)};Ve.propTypes={record:y().object.isRequired,isPreview:y().bool.isRequired};var Je=n(38221),Ye=n.n(Je),We=n(62513);function Xe(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,Ge()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function Ge(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ge=function(){return!!e})()}var Ke=function(e){function t(e){var n;return(0,o.A)(this,t),n=Xe(this,t,[e]),(0,R.A)(n,"placeholderLoader",(function(){return r.createElement(Ue.A,null,r.createElement(Ue.A.Paragraph,null,r.createElement(Ue.A.Line,null),r.createElement(Ue.A.Line,null),r.createElement(Ue.A.Line,null)))})),(0,R.A)(n,"errorMessage",(function(e){return r.createElement(f.A,{negative:!0},e)})),(0,R.A)(n,"fetchCitation",function(){var e=(0,h.A)(g().mark((function e(t,n,r){var a,o;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!0===r?"&include_deleted=1":"",o="".concat(t.links.self,"?locale=").concat(navigator.language,"&style=").concat(n).concat(a),e.next=4,b.http.get(o,{headers:{Accept:"text/x-bibliography"}});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()),(0,R.A)(n,"getCitation",function(){var e=(0,h.A)(g().mark((function e(t,r,a){var o;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({loading:!0,citation:"",error:""}),n.cancellableFetchCitation=(0,b.withCancel)(n.fetchCitation(t,r,a)),e.prev=2,e.next=5,n.cancellableFetchCitation.promise;case 5:o=e.sent,n.setState({loading:!1,citation:o.data}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),"UNMOUNTED"!==e.t0&&n.setState({loading:!1,citation:"",error:u.M.t("An error occurred while generating the citation.")});case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,n,r){return e.apply(this,arguments)}}()),n.state={loading:!0,citation:"",error:null},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.record,n=e.defaultStyle,r=e.includeDeleted;this.getCitation(t,n,r)}},{key:"componentWillUnmount",value:function(){var e;null===(e=this.cancellableFetchCitation)||void 0===e||e.cancel()}},{key:"render",value:function(){var e=this,t=this.props,n=t.styles,a=t.record,o=t.defaultStyle,i=t.includeDeleted,c=this.state,l=c.loading,s=c.citation,d=c.error,m=n.map((function(e){return{key:e[0],value:e[0],text:e[1]}}));return r.createElement("div",null,r.createElement("div",{id:"citation-text",className:"wrap-overflowing-text rel-mb-2"},l?this.placeholderLoader():s),r.createElement("div",{className:"auto-column-grid no-wrap"},r.createElement("div",{className:"flex align-items-center"},r.createElement("label",{id:"citation-style-label",className:"mr-10"},u.M.t("Style")),r.createElement(D.A,{className:"citation-dropdown","aria-labelledby":"citation-style-label",defaultValue:o,options:m,selection:!0,onChange:Ye()((function(t,n){return e.getCitation(a,n.value,i)}),500)})),r.createElement(We.i,{text:s})),d?this.errorMessage(d):null)}}])}(r.Component);function $e(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,Qe()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function Qe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Qe=function(){return!!e})()}Ke.propTypes={styles:y().array.isRequired,record:y().object.isRequired,defaultStyle:y().string.isRequired,includeDeleted:y().bool.isRequired};var Ze=function(e){function t(e){var n,r;(0,o.A)(this,t);var a=(r=$e(this,t,[e])).props.formats;return r.state={selectedFormatUrl:null===(n=a[0])||void 0===n?void 0:n.export_url},r}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this,t=this.props.formats,n=this.state.selectedFormatUrl,a=t.map((function(e,t){return{key:"option-".concat(t),text:e.name,value:e.export_url}}));return r.createElement(d.A,null,r.createElement(d.A.Column,{width:11},r.createElement(D.A,{"aria-label":u.M.t("Export selection"),selection:!0,fluid:!0,selectOnNavigation:!1,options:a,onChange:function(t,n){return e.setState({selectedFormatUrl:n.value})},defaultValue:n})),r.createElement(d.A.Column,{width:5,className:"pl-0"},r.createElement(m.A,{as:"a",role:"button",fluid:!0,href:n,title:u.M.t("Download file")},u.M.t("Export"))))}}])}(r.Component);Ze.propTypes={formats:y().array.isRequired};var et=n(27041);function tt(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,nt()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function nt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(nt=function(){return!!e})()}var rt=function(e){function t(e){var n;return(0,o.A)(this,t),n=tt(this,t,[e]),(0,R.A)(n,"openConfirmModal",(function(){return n.setState({modalOpen:!0})})),(0,R.A)(n,"closeConfirmModal",(function(){return n.setState(n.INITIAL_STATE)})),(0,R.A)(n,"handleDelete",(0,h.A)(g().mark((function e(){var t,r,a,o,i,c;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props,r=t.result,a=t.recordCommunityEndpoint,o=t.successCallback,n.setState({loading:!0}),i={communities:[{id:r.id}]},e.prev=3,e.next=6,b.http.delete(a,{data:i});case 6:c=e.sent,o(c.data),n.closeConfirmModal(),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),n.setState({error:e.t0,loading:!1});case 14:case"end":return e.stop()}}),e,null,[[3,11]])})))),(0,R.A)(n,"handleCheckboxChange",(function(e,t){var r=t.id,a=t.checked,o=n.state,i=o.checkboxRecords,c=o.checkboxMembers;"members-confirm"===r&&n.setState({checkboxMembers:a,buttonDisabled:!(a&&i)}),"records-confirm"===r&&n.setState({checkboxRecords:a,buttonDisabled:!(c&&a)})})),n.INITIAL_STATE={modalOpen:!1,loading:!1,error:void 0,checkboxMembers:!1,checkboxRecords:!1,buttonDisabled:!0},n.state=n.INITIAL_STATE,n.checkBoxRef=r.createRef(),n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"componentDidUpdate",value:function(){if(this.state.modalOpen&&this.checkBoxRef){var e,t=this.checkBoxRef.current.inputRef;null===t||void 0===t||null===(e=t.current)||void 0===e||e.focus()}}},{key:"render",value:function(){var e,t=this,n=this.state,a=n.modalOpen,o=n.loading,i=n.error,c=n.checkboxMembers,l=n.checkboxRecords,s=n.buttonDisabled,d=this.props.result.metadata.title;return r.createElement(r.Fragment,null,r.createElement(m.A,{size:"tiny",negative:!0,labelPosition:"left",icon:"trash",floated:"right",onClick:this.openConfirmModal,content:u.M.t("Remove"),"aria-label":u.M.t("Remove {{communityTitle}} from this record",{communityTitle:d})}),r.createElement(O.A,{size:"tiny",dimmer:"blurring",open:a},r.createElement(O.A.Header,{as:"h2"},u.M.t("Remove community")),r.createElement(O.A.Content,null,r.createElement("p",null,u.M.t("Are you sure you want to remove the record from the community?")),r.createElement(f.A,{negative:!0},r.createElement(f.A.Header,{className:"rel-mb-1"},r.createElement(p.A,{name:"warning sign",className:"rel-mr-1"}),u.M.t("I understand the consequences:")),r.createElement(r.Fragment,null,r.createElement(le.A,{ref:this.checkBoxRef,id:"members-confirm",label:r.createElement("label",null,r.createElement(Le.x,null,"Members of the community ",r.createElement("b",null,'"',{communityTitle:d},'"')," will"," ",r.createElement("u",null,"lose their access")," to the record.")),checked:c,onChange:this.handleCheckboxChange,className:"mb-5"}),r.createElement(le.A,{id:"records-confirm",label:u.M.t("The record can only be re-included in the community by going through a new review by the community curators."),checked:l,onChange:this.handleCheckboxChange,className:"mb-5"})))),r.createElement(O.A.Actions,null,i&&r.createElement(b.ErrorMessage,{header:u.M.t("Something went wrong"),content:(null===(e=i.response)||void 0===e||null===(e=e.data)||void 0===e||null===(e=e.errors[0])||void 0===e?void 0:e.message)||i.message,icon:"exclamation",className:"text-align-left",negative:!0}),r.createElement(m.A,{onClick:function(){return t.closeConfirmModal()},floated:"left",disabled:o,loading:o,"aria-label":u.M.t("Cancel removal")},u.M.t("Cancel")),r.createElement(m.A,{disabled:s||o,negative:!0,onClick:function(){return t.handleDelete()},loading:o,content:u.M.t("Remove"),"aria-label":u.M.t("Confirm removal")}))))}}])}(r.Component);rt.propTypes={result:y().object.isRequired,recordCommunityEndpoint:y().object.isRequired,successCallback:y().func.isRequired};var at=n(78585);function ot(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,it()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function it(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(it=function(){return!!e})()}var ct=function(e){function t(e){var n;return(0,o.A)(this,t),n=ot(this,t,[e]),(0,R.A)(n,"handleSetBranding",function(){var e=(0,h.A)(g().mark((function e(t){var r,a,o,i,c,l;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.props,a=r.recordCommunityEndpoint,o=r.updateRecordCallback,n.setState({loading:!0}),i={default:t},n.cancellableAction=(0,b.withCancel)(b.http.put(a,i)),e.prev=4,e.next=7,n.cancellableAction.promise;case 7:c=e.sent,n.setState({loading:!1}),o(c.data),e.next=18;break;case 12:if(e.prev=12,e.t0=e.catch(4),"UNMOUNTED"!==e.t0){e.next=16;break}return e.abrupt("return");case 16:console.error(e.t0),n.setState({error:(null===e.t0||void 0===e.t0||null===(l=e.t0.response)||void 0===l||null===(l=l.data)||void 0===l?void 0:l.message)||(null===e.t0||void 0===e.t0?void 0:e.t0.message),loading:!1});case 18:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t){return e.apply(this,arguments)}}()),(0,R.A)(n,"renderCommunity",(function(){var e=n.state.loading,t=n.props,a=t.result,o=t.isCommunityDefault,i=a.metadata.title;return o?r.createElement(k.A,{trigger:r.createElement(m.A,{size:"tiny",labelPosition:"left",icon:"paint brush",floated:"right",onClick:function(){return n.handleSetBranding("")},content:u.M.t("Remove branding"),"aria-label":u.M.t("{{communityTitle}} is a default branding for this record",{communityTitle:i}),loading:e}),content:u.M.t("Remove this community from appearing on top of the record details page."),position:"top center"}):r.createElement(k.A,{trigger:r.createElement(m.A,{size:"tiny",labelPosition:"left",icon:"paint brush",floated:"right",onClick:function(){return n.handleSetBranding(a.id)},content:u.M.t("Set branding"),"aria-label":u.M.t("Set {{communityTitle}} as a default branding for this record",{communityTitle:i}),loading:e}),content:u.M.t("Set this community to appear on the top of the record details page."),position:"top center"})})),n.state={loading:!1,error:void 0},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"componentWillUnmount",value:function(){this.cancellableAction&&this.cancellableAction.cancel()}},{key:"render",value:function(){var e=this.state.error;return e?r.createElement(f.A,{negative:!0,floated:"right",className:"community-branding-error",size:"tiny"},e):this.renderCommunity()}}])}(r.Component);function lt(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,st()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function st(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(st=function(){return!!e})()}ct.propTypes={result:y().object.isRequired,recordCommunityEndpoint:y().object.isRequired,updateRecordCallback:y().func.isRequired,isCommunityDefault:y().bool.isRequired};var ut=function(e){function t(){return(0,o.A)(this,t),lt(this,t,arguments)}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e,t=this.props,n=t.result,a=t.successCallback,o=t.updateRecordCallback,i=t.recordCommunityEndpoint,c=t.recordParent,l=t.permissions.can_manage,s=(null===c||void 0===c||null===(e=c.communities)||void 0===e?void 0:e.default)===(null===n||void 0===n?void 0:n.id),u=l&&r.createElement(r.Fragment,null,r.createElement(ct,{result:n,recordCommunityEndpoint:i,updateRecordCallback:o,isCommunityDefault:s}),r.createElement(rt,{result:n,recordCommunityEndpoint:i,successCallback:a}));return r.createElement(at.mG,{actions:u,result:n,isCommunityDefault:s})}}])}(r.Component);ut.propTypes={result:y().object.isRequired,recordCommunityEndpoint:y().string.isRequired,successCallback:y().func.isRequired,updateRecordCallback:y().func.isRequired,permissions:y().object.isRequired,recordParent:y().object.isRequired};var dt=n(98871);function mt(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,pt()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function pt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(pt=function(){return!!e})()}var ft="InvenioAppRdm.RecordCommunitiesSearch",ht=function(e){function t(){var e;(0,o.A)(this,t);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=mt(this,t,[].concat(r)),(0,R.A)(e,"handleSuccessCallback",(function(t){(0,e.props.successActionCallback)(t,u.M.t("Success"))})),e}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this.props,t=e.recordCommunityEndpoint,n=e.permissions,a=e.recordParent,o=e.updateRecordCallback,i=(0,R.A)({},"".concat(ft,".ResultsList.item"),(0,_e.parametrize)(ut,{recordCommunityEndpoint:t,successCallback:this.handleSuccessCallback,updateRecordCallback:o,permissions:n,recordParent:a})),c=new dt.HZ({axios:{url:t,headers:{Accept:"application/vnd.inveniordm.v1+json"}}});return r.createElement(_e.OverridableContext.Provider,{value:i},r.createElement(dt.gz,{appName:ft,urlHandlerApi:{enabled:!1},searchApi:c,initialQueryState:{size:5,page:1}},r.createElement(r.Fragment,null,r.createElement(O.A.Content,null,r.createElement(dt.IW,{autofocus:!0,actionProps:{icon:"search",content:null,className:"search","aria-label":u.M.t("Search")},placeholder:u.M.t("Search for community...")})),r.createElement(O.A.Content,{scrolling:!0,className:"community-list-results"},r.createElement(dt.oK,null,r.createElement(dt.i6,null),r.createElement(dt.$D,null),r.createElement(dt.dy,null))),r.createElement(O.A.Content,{className:"text-align-center"},r.createElement(dt.dK,null)))))}}])}(r.Component);function vt(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,At()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function At(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(At=function(){return!!e})()}ht.propTypes={recordCommunityEndpoint:y().string.isRequired,successActionCallback:y().func.isRequired,updateRecordCallback:y().func.isRequired,permissions:y().object.isRequired,recordParent:y().object.isRequired};var gt=function(e){function t(e){var n;(0,o.A)(this,t),n=vt(this,t,[e]),(0,R.A)(n,"handleRecordUpdate",(function(e){n.setState({recordParent:e})}));var r=n.props.record;return n.state={recordParent:r.parent},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this.props,t=e.recordCommunityEndpoint,n=e.modalOpen,a=e.successActionCallback,o=e.handleOnOpen,i=e.handleOnClose,c=e.trigger,l=e.permissions,s=this.state.recordParent;return r.createElement(O.A,{role:"dialog","aria-labelledby":"record-communities-header",id:"community-selection-modal",closeOnDimmerClick:!1,closeIcon:!0,open:n,onClose:i,onOpen:o,trigger:c},r.createElement(O.A.Header,null,r.createElement(et.A,{as:"h2",size:"small",id:"record-communities-header",className:"mt-5"},u.M.t("Communities"))),r.createElement(ht,{recordCommunityEndpoint:t,successActionCallback:a,permissions:l,recordParent:s,updateRecordCallback:this.handleRecordUpdate}),r.createElement(O.A.Actions,null,r.createElement(m.A,{onClick:i},u.M.t("Close"))))}}])}(r.Component);function bt(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,Et()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function Et(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Et=function(){return!!e})()}gt.propTypes={recordCommunityEndpoint:y().string.isRequired,trigger:y().object,modalOpen:y().bool,successActionCallback:y().func.isRequired,handleOnClose:y().func.isRequired,handleOnOpen:y().func.isRequired,permissions:y().object.isRequired,record:y().object.isRequired},gt.defaultProps={modalOpen:!1,trigger:void 0};var yt=function(e){function t(){return(0,o.A)(this,t),bt(this,t,arguments)}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this.props,t=e.communities,n=e.loading,a=e.error,o=e.maxDisplayedCommunities,i=e.branded,c=null;if(n)c=r.createElement(Ue.A,null,r.createElement(Ue.A.Header,{image:!0},r.createElement(Ue.A.Line,null),r.createElement(Ue.A.Line,null)),r.createElement(Ue.A.Header,{image:!0},r.createElement(Ue.A.Line,null),r.createElement(Ue.A.Line,null)),r.createElement(Ue.A.Header,{image:!0},r.createElement(Ue.A.Line,null),r.createElement(Ue.A.Line,null)));else if(N()(t))c=r.createElement("p",null,r.createElement("i",null,r.createElement("small",null,u.M.t("This record is not included in any communities yet."))));else if((null===t||void 0===t?void 0:t.length)>0){var l=null===t||void 0===t?void 0:t.slice(0,o).map((function(e){return r.createElement(ge.A,{key:e.id},r.createElement(b.Image,{wrapped:!0,size:"mini",src:e.links.logo,alt:""}),r.createElement(ge.A.Content,{verticalAlign:"middle"},r.createElement(ge.A.Header,{as:et.A},r.createElement(et.A,{as:"a",href:e.links.self_html,size:"small"},e.metadata.title),e.id===i&&(null===e||void 0===e?void 0:e.theme)&&r.createElement("p",{className:"ml-5 display-inline-block"},r.createElement(k.A,{content:"Verified community",trigger:r.createElement(p.A,{color:"green",name:"check circle outline"}),position:"top center"})))))}));c=r.createElement(r.Fragment,null,r.createElement(ge.A.Group,{unstackable:!0},l),a&&r.createElement(f.A,{error:!0},a))}return c}}])}(r.Component);yt.propTypes={maxDisplayedCommunities:y().number.isRequired,communities:y().array,loading:y().bool,error:y().string,branded:y().string},yt.defaultProps={communities:void 0,loading:!1,error:"",branded:void 0};var Ct=n(2685),kt=n(25306),Rt=(n(2776),n(9504),n(42035),n(2115),n(91343));n(46842),n(13254),n(87664),n(51253),n(43977);function St(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,Mt()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function Mt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Mt=function(){return!!e})()}var Ot=function(e){function t(){return(0,o.A)(this,t),St(this,t,arguments)}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this.props,t=e.result,n=e.successCallback,a=t.expanded.receiver,o=t.links.self_html.replace("/requests","/me/requests"),i=r.createElement(Rt.U,{request:t,actionSuccessCallback:n});return r.createElement(at.mG,{result:a,actions:i,detailUrl:o})}}])}(r.Component);function wt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xt(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,qt()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function qt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(qt=function(){return!!e})()}Ot.propTypes={result:y().object.isRequired,successCallback:y().func.isRequired};var Nt="InvenioAppRdm.PendingCommunitiesSearch",_t=function(e){function t(){var e;(0,o.A)(this,t);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return e=xt(this,t,[].concat(r)),(0,R.A)(e,"handleSuccessCallback",(function(t){(0,e.props.successActionCallback)(t,u.M.t("Success"))})),e}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this.props.searchConfig,t=new dt.HZ(e.searchApi),n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wt(Object(n),!0).forEach((function(t){(0,R.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}((0,R.A)({},"".concat(Nt,".ResultsList.item"),(0,_e.parametrize)(Ot,{successCallback:this.handleSuccessCallback})),kt.Lu);return r.createElement(_e.OverridableContext.Provider,{value:n},r.createElement(dt.gz,{appName:Nt,urlHandlerApi:{enabled:!1},searchApi:t,initialQueryState:e.initialQueryState},r.createElement(r.Fragment,null,r.createElement(O.A.Content,null,r.createElement(dt.IW,{autofocus:!0,actionProps:{icon:"search",content:null,className:"search","aria-label":u.M.t("Search")},placeholder:u.M.t("Search for pending submissions to communities...")})),r.createElement(O.A.Content,{scrolling:!0,className:"community-list-results"},r.createElement(dt.oK,null,r.createElement(dt.i6,null),r.createElement(dt.$D,null),r.createElement(dt.dy,null))),r.createElement(O.A.Content,{className:"text-align-center"},r.createElement(dt.dK,null)))))}}])}(r.Component);function Pt(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,Dt()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function Dt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Dt=function(){return!!e})()}_t.propTypes={searchConfig:y().object.isRequired,successActionCallback:y().func.isRequired};var Tt=function(e){function t(){return(0,o.A)(this,t),Pt(this,t,arguments)}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this.props,t=e.searchConfig,n=e.modalOpen,a=e.successActionCallback,o=e.handleOnOpen,i=e.handleOnClose;return r.createElement(O.A,{role:"dialog","aria-labelledby":"record-communities-header",id:"community-selection-modal",closeIcon:!0,closeOnDimmerClick:!1,open:n,onClose:i,onOpen:o},r.createElement(O.A.Header,null,r.createElement(et.A,{as:"h2",size:"small",id:"record-communities-header",className:"mt-5"},u.M.t("Pending communities"))),r.createElement(_t,{searchConfig:t,successActionCallback:a}),r.createElement(O.A.Actions,null,r.createElement(m.A,{onClick:i},u.M.t("Close"))))}}])}(r.Component);function jt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function It(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jt(Object(n),!0).forEach((function(t){(0,R.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Bt(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,Ut()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function Ut(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Ut=function(){return!!e})()}Tt.propTypes={searchConfig:y().object.isRequired,modalOpen:y().bool,successActionCallback:y().func.isRequired,handleOnClose:y().func.isRequired,handleOnOpen:y().func.isRequired},Tt.defaultProps={modalOpen:!1};var Lt=function(e){function t(e){var n;return(0,o.A)(this,t),n=Bt(this,t,[e]),(0,R.A)(n,"changeSelectedCommunity",(function(e){n.setState({selectedCommunity:e,error:null}),n.openConfirmModal()})),(0,R.A)(n,"canIncludeDirectly",(function(){var e=n.state.selectedCommunity;return n.props.userCommunitiesMemberships[null===e||void 0===e?void 0:e.id]&&"open"===(null===e||void 0===e?void 0:e.access.review_policy)})),(0,R.A)(n,"isIncludedDirectly",(function(e){return e.is_closed&&"accepted"===e.status})),(0,R.A)(n,"handleSuccessSubmit",(function(e){var t=n.props.handleSuccessAction;n.closeConfirmModal(),n.isIncludedDirectly(e.processed[0].request)?t(e,u.M.t("Record submitted")):t(e,u.M.t("Review requested"))})),(0,R.A)(n,"submitCommunity",function(){var e=(0,h.A)(g().mark((function e(t){var r,a,o,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.props.recordCommunityEndpoint,a=n.state.selectedCommunity,n.setState({loading:!0,error:null}),e.prev=3,o={communities:[{id:a.id}]},t&&(o={communities:[{id:a.id,comment:{payload:{content:t,format:"html"}}}]}),e.next=8,b.http.post(r,o);case 8:i=e.sent,n.handleSuccessSubmit(i.data),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(3),console.error(e.t0),n.setState({error:e.t0.response.data.errors[0].message});case 16:return e.prev=16,n.setState({loading:!1}),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[3,12,16,19]])})));return function(t){return e.apply(this,arguments)}}()),(0,R.A)(n,"openConfirmModal",(function(){return n.setState({confirmationModalOpen:!0})})),(0,R.A)(n,"closeConfirmModal",(function(){return n.setState({confirmationModalOpen:!1})})),n.state={confirmationModalOpen:!1,selectedCommunity:null,loading:!1,error:null},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.selectedCommunity,a=t.confirmationModalOpen,o=t.loading,i=t.error,c=this.props,l=c.userCommunitiesMemberships,s=c.modalOpen,d=c.toggleModal,m=c.recordUserCommunitySearchConfig,p=c.recordCommunitySearchConfig,h=c.handleClose,v=c.record,A={allCommunities:It(It({},p),{},{toggleText:u.M.t("Search in all communities")}),myCommunities:It(It({},m),{},{toggleText:u.M.t("Search in my communities")})};return r.createElement(r.Fragment,null,r.createElement(Ne.qE,{onCommunityChange:this.changeSelectedCommunity,chosenCommunity:n,modalOpen:s,userCommunitiesMemberships:l,onModalChange:d,modalHeader:u.M.t("Select a community"),apiConfigs:A,handleClose:h,record:v,isInitialSubmission:!1}),a&&r.createElement(Ne.Kd,{loading:o,errors:i&&r.createElement(f.A,{error:!0},i),isConfirmModalOpen:a,onSubmit:function(t){var n=t.reviewComment;return e.submitCommunity(n)},community:n,onClose:function(){return e.closeConfirmModal()},directPublish:this.canIncludeDirectly(),record:v}))}}])}(r.Component);function Ft(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,zt()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function zt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(zt=function(){return!!e})()}Lt.propTypes={modalOpen:y().bool,toggleModal:y().func.isRequired,userCommunitiesMemberships:y().object.isRequired,handleSuccessAction:y().func.isRequired,recordCommunityEndpoint:y().string.isRequired,recordCommunitySearchConfig:y().object.isRequired,recordUserCommunitySearchConfig:y().string.isRequired,handleClose:y().func.isRequired,record:y().object.isRequired},Lt.defaultProps={modalOpen:!1};var Ht=function(e){function t(e){var n;return(0,o.A)(this,t),n=Ft(this,t,[e]),(0,R.A)(n,"focusDropdownRef",(function(){n.dropdownRef.current.ref.current.focus()})),(0,R.A)(n,"handleSuccessAction",(function(e,t){var r=n.props.actionSucceed;n.setState({actionFeedback:t,visibleSuccessAction:!1}),n.toggleSubmissionModal(!1),n.togglePendingRequestsModal(!1),n.setState({visibleSuccessAction:!0}),n.focusDropdownRef(),r()})),(0,R.A)(n,"toggleSubmissionModal",(function(e){n.setState({submissionModalOpen:e}),e||n.focusDropdownRef()})),(0,R.A)(n,"togglePendingRequestsModal",(function(e){n.setState({pendingRequestModalOpen:e}),e||n.focusDropdownRef()})),(0,R.A)(n,"handleChange",(function(e,t){var r=n.props.toggleManageCommunitiesModal;switch(t.value){case"submit-to-community":n.toggleSubmissionModal(!0);break;case"pending-submissions":n.togglePendingRequestsModal(!0);break;case"manage-communities":r(!0);break;default:return}})),n.state={submissionModalOpen:!1,pendingRequestModalOpen:!1,visibleSuccessAction:!1,actionFeedback:""},n.dropdownRef=r.createRef(),n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.visibleSuccessAction,a=t.submissionModalOpen,o=t.actionFeedback,i=t.pendingRequestModalOpen,c=this.props,l=c.userCommunitiesMemberships,s=c.searchConfig,d=c.recordCommunitySearchConfig,m=c.recordCommunityEndpoint,f=c.recordUserCommunitySearchConfig,h=c.record,v=[{id:"submit-to-community",value:"submit-to-community",text:u.M.t("Submit to community"),icon:"plus"},{id:"pending-submissions",value:"pending-submissions",text:u.M.t("Pending submissions"),icon:"comments outline"},{id:"manage-communities",value:"manage-communities",text:u.M.t("Manage communities"),icon:"settings"}];return r.createElement(r.Fragment,null,r.createElement("div",{className:"flex align-items-baseline ml-auto rel-mr-1 green-color"},n&&r.createElement(U.B,{timeOutDelay:5e3,show:n,content:r.createElement("div",{role:"alert",className:"half-width sub header small text size truncated"},o)})),r.createElement(D.A,{ref:this.dropdownRef,id:"modal-dropdown",className:"manage-menu-dropdown","aria-label":u.M.t("Community management menu dropdown"),closeOnChange:!0,direction:"left",options:v,onChange:this.handleChange,selectOnBlur:!1,selectOnNavigation:!1,value:null,trigger:r.createElement(p.A,{name:"cog",color:"grey",className:"ml-0"})}),r.createElement(Lt,{modalOpen:a,userCommunitiesMemberships:l,toggleModal:this.toggleSubmissionModal,handleClose:function(){return e.toggleSubmissionModal(!1)},handleSuccessAction:this.handleSuccessAction,recordCommunityEndpoint:m,recordCommunitySearchConfig:d,recordUserCommunitySearchConfig:f,record:h}),r.createElement(Tt,{modalOpen:i,handleOnOpen:function(){return e.togglePendingRequestsModal(!0)},handleOnClose:function(){return e.togglePendingRequestsModal(!1)},successActionCallback:this.handleSuccessAction,searchConfig:s}))}}])}(r.Component);function Vt(e,t,n){return t=(0,l.A)(t),(0,c.A)(e,Jt()?Reflect.construct(t,n||[],(0,l.A)(e).constructor):t.apply(e,n))}function Jt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Jt=function(){return!!e})()}Ht.propTypes={userCommunitiesMemberships:y().object.isRequired,recordCommunityEndpoint:y().string.isRequired,recordCommunitySearchConfig:y().string.isRequired,recordUserCommunitySearchConfig:y().string.isRequired,toggleManageCommunitiesModal:y().func.isRequired,actionSucceed:y().func,searchConfig:y().object.isRequired,record:y().object.isRequired},Ht.defaultProps={actionSucceed:void 0};var Yt=function(e){function t(e){var n;return(0,o.A)(this,t),n=Vt(this,t,[e]),(0,R.A)(n,"toggleManageCommunitiesModal",(function(e){if(!e){var t=document.getElementById("modal-dropdown");t&&t.focus()}n.setState({manageCommunitiesModalOpen:e})})),(0,R.A)(n,"fetchRecordCommunities",(0,h.A)(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props.recordCommunityEndpoint,e.next=3,b.http.get(t,{headers:{Accept:"application/vnd.inveniordm.v1+json"}});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))),(0,R.A)(n,"getCommunities",(0,h.A)(g().mark((function e(){var t,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.cancellableFetchCommunities=(0,b.withCancel)(n.fetchRecordCommunities()),n.setState({loading:!0,error:null}),e.prev=2,e.next=5,n.cancellableFetchCommunities.promise;case 5:t=e.sent,r=t.data.hits.hits,n.setState({communities:r,loading:!1}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),"UNMOUNTED"!==e.t0&&n.setState({loading:!1,error:u.M.t("An error occurred while fetching communities.")});case 13:case"end":return e.stop()}}),e,null,[[2,10]])})))),(0,R.A)(n,"handleRefresh",(function(){n.getCommunities(),n.toggleManageCommunitiesModal(!1)})),n.state={loading:!0,communities:void 0,error:void 0,manageCommunitiesModalOpen:!1},n}return(0,s.A)(t,e),(0,i.A)(t,[{key:"componentDidMount",value:function(){this.getCommunities()}},{key:"componentWillUnmount",value:function(){var e;null===(e=this.cancellableFetchCommunities)||void 0===e||e.cancel()}},{key:"render",value:function(){var e,t=this,n=this.props,a=n.recordCommunitySearchConfig,o=n.permissions,i=n.canManageRecord,c=n.userCommunitiesMemberships,l=n.recordCommunityEndpoint,s=n.recordUserCommunitySearchConfig,d=n.searchConfig,p=n.record,f=this.state,h=f.communities,v=f.loading,A=f.error,g=f.manageCommunitiesModalOpen;return(!N()(h)||i)&&r.createElement(r.Fragment,null,r.createElement(et.A,{size:"medium",as:"h2",className:"flex align-items-baseline mt-0",attached:"top"},u.M.t("Communities"),i&&r.createElement(Ht,{actionSucceed:this.handleRefresh,userCommunitiesMemberships:c,recordCommunityEndpoint:l,searchConfig:d,recordCommunitySearchConfig:a,recordUserCommunitySearchConfig:s,toggleManageCommunitiesModal:this.toggleManageCommunitiesModal,record:p})),r.createElement(Ct.A,{attached:"bottom",className:"rdm-sidebar"},r.createElement(yt,{permissions:o,communities:h,error:A,loading:v,maxDisplayedCommunities:3,branded:null===(e=p.parent)||void 0===e||null===(e=e.communities)||void 0===e?void 0:e.default}),r.createElement(gt,{id:"record-communities-list-modal",modalOpen:g,handleOnOpen:function(){return t.toggleManageCommunitiesModal(!0)},handleOnClose:function(){return t.toggleManageCommunitiesModal(!1)},successActionCallback:this.handleRefresh,recordCommunityEndpoint:l,permissions:o,record:p}),!v&&(null===h||void 0===h?void 0:h.length)>3&&r.createElement(M.A,{align:"center",className:"mt-10"},r.createElement(m.A,{className:"transparent","aria-haspopup":"dialog","aria-expanded":g,"aria-controls":"record-communities-list-modal",onClick:function(){return t.toggleManageCommunitiesModal(!0)}},u.M.t("View all {{count}} communities",{count:h.length})))))}}])}(r.Component);Yt.propTypes={recordCommunitySearchConfig:y().object.isRequired,recordCommunityEndpoint:y().string.isRequired,recordUserCommunitySearchConfig:y().object.isRequired,permissions:y().object.isRequired,canManageRecord:y().bool.isRequired,userCommunitiesMemberships:y().object.isRequired,searchConfig:y().object.isRequired,record:y().object.isRequired};var Wt=document.getElementById("recordManagement"),Xt=document.getElementById("recordManagementMobile"),Gt=document.getElementById("recordVersions"),Kt=document.getElementById("recordCitation"),$t=document.getElementById("recordExportDownload"),Qt=document.getElementById("sidebar-communities-manage");function Zt(e){a.render(r.createElement(_e.OverridableContext.Provider,{value:_e.overrideStore.getAll()},r.createElement(je,{record:JSON.parse(Wt.dataset.record),permissions:JSON.parse(Wt.dataset.permissions),isDraft:JSON.parse(Wt.dataset.isDraft),isPreviewSubmissionRequest:JSON.parse(Wt.dataset.isPreviewSubmissionRequest),currentUserId:Wt.dataset.currentUserId,recordOwnerUsername:Wt.dataset.recordOwnerUsername,accessLinksSearchConfig:JSON.parse(Wt.dataset.accessLinksSearchConfig)})),e)}if(Wt&&(Zt(Wt),Xt&&Zt(Xt)),Gt&&a.render(r.createElement(Ve,{record:JSON.parse(Gt.dataset.record),isPreview:JSON.parse(Gt.dataset.preview)}),Gt),Kt&&a.render(r.createElement(Ke,{record:JSON.parse(Kt.dataset.record),styles:JSON.parse(Kt.dataset.styles),defaultStyle:JSON.parse(Kt.dataset.defaultstyle),includeDeleted:JSON.parse(Kt.dataset.includeDeleted)}),Kt),$t&&a.render(r.createElement(Ze,{formats:JSON.parse($t.dataset.formats)}),$t),Qt){var en=JSON.parse(Qt.dataset.recordCommunitySearchConfig),tn=Qt.dataset.pendingCommunitiesSearchConfig;a.render(r.createElement(Yt,{userCommunitiesMemberships:JSON.parse(Qt.dataset.userCommunitiesMemberships),recordCommunityEndpoint:Qt.dataset.recordCommunityEndpoint,recordUserCommunitySearchConfig:JSON.parse(Qt.dataset.recordUserCommunitySearchConfig),canManageRecord:JSON.parse(Qt.dataset.canManageRecord),recordCommunitySearchConfig:en,permissions:JSON.parse(Qt.dataset.permissions),searchConfig:JSON.parse(tn),record:JSON.parse(Kt.dataset.record)}),Qt)}},38992:(e,t,n)=>{"use strict";n.d(t,{$:()=>s,h:()=>l});var r=n(58156),a=n.n(r),o=n(96540),i=n(70742),c=n(91272);function l(e){var t=e.creators,n=e.className,r=e.othersLink,c="creatibutor-wrap separated";function l(e){var t=a()(e,"person_or_org.identifiers",[]),n=a()(e,"person_or_org.name","No name");return t.map((function(e){return function(e,t,n){var r=null,a=null,c=null,l="";switch(e){case"orcid":r="https://orcid.org/".concat(t),a=i.M.t("ORCID profile"),c="/static/images/orcid.svg",l="ORCID logo";break;case"ror":r="https://ror.org/".concat(t),a=i.M.t("ROR profile"),c="/static/images/ror-icon.svg",l="ROR logo";break;case"gnd":r="https://d-nb.info/gnd/".concat(t),a=i.M.t("GND profile"),c="/static/images/gnd-icon.svg",l="GND logo";break;default:return null}return o.createElement("a",{className:"no-text-decoration mr-0",href:r,"aria-label":"".concat(n,": ").concat(a),title:"".concat(n,": ").concat(a),key:e},o.createElement("img",{className:"inline-id-icon ml-5",src:c,alt:l}))}(e.scheme,e.identifier,n)}))}n&&(c+=" ".concat(n));var s,u=t.slice(0,3).map((function(e){return o.createElement("span",{className:c,key:e.person_or_org.name},function(e){var t=a()(e,"person_or_org.name","No name");return o.createElement("a",{className:"creatibutor-link",href:'/search?q=metadata.creators.person_or_org.name:"'.concat(t,'"'),title:"".concat(t,": ").concat(i.M.t("Search"))},o.createElement("span",{className:"creatibutor-name"},t))}(e),l(e))})),d=t.length-3;0<d&&(s=1===d?"and {{count}} other":"and {{count}} others",u.push(o.createElement("span",{className:c,key:s},o.createElement("a",{className:"creatibutor-link",href:r},o.createElement("span",{className:"creatibutor-name"},i.M.t(s,{count:d}))))));return u}var s=function(e){return c.DateTime.fromISO(e).setLocale(i.M.language).toRelative()}},60996:(e,t,n)=>{"use strict";n.d(t,{r:()=>s});var r=n(96540),a=n(93682),o=n(28085),i=n(76217),c=n(5556),l=n.n(c),s=function(e){var t=e.trigger,n=e.error;return r.createElement(a.A,{basic:!0,className:"p-0 borderless shadowless mb-1",open:!!n,position:"top center",content:r.createElement(o.A,{content:n,basic:!0,className:"mb-5 error",pointing:"below",removeIcon:"close"}),trigger:t})};s.propTypes={trigger:l().node,error:l().string},s.defaultProps={error:"",trigger:r.createElement(i.A,{name:"exclamation circle",className:"error"})}},88860:(e,t,n)=>{"use strict";n.d(t,{B:()=>h});var r=n(23029),a=n(92901),o=n(56822),i=n(53954),c=n(85501),l=n(64467),s=n(5556),u=n.n(s),d=n(96540),m=n(76217);function p(e,t,n){return t=(0,i.A)(t),(0,o.A)(e,f()?Reflect.construct(t,n||[],(0,i.A)(e).constructor):t.apply(e,n))}function f(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(f=function(){return!!e})()}var h=function(e){function t(e){var n;(0,r.A)(this,t),n=p(this,t,[e]),(0,l.A)(n,"handleOnTimeOut",(function(){n.setState({show:!1})}));var a=e.show;return n.state={show:a},n}return(0,c.A)(t,e),(0,a.A)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.timeOutDelay,n=e.show;this.setState({show:n});var r=!!this.successTimer;n&&(r&&clearTimeout(this.successTimer),this.successTimer=setTimeout(this.handleOnTimeOut,t))}},{key:"componentWillUnmount",value:function(){this.successTimer&&clearTimeout(this.successTimer)}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.content;return this.state.show&&d.createElement(d.Fragment,null,d.createElement(m.A,{name:"checkmark",className:"positive ".concat(t)}),void 0!==n&&n)}}])}(d.Component);h.propTypes={timeOutDelay:u().number.isRequired,show:u().bool,className:u().string,content:u().string},h.defaultProps={show:!1,className:"",content:void 0}},84684:(e,t,n)=>{var r=n(69302),a=n(75288),o=n(36800),i=n(37241),c=Object.prototype,l=c.hasOwnProperty,s=r((function(e,t){e=Object(e);var n=-1,r=t.length,s=r>2?t[2]:void 0;for(s&&o(t[0],t[1],s)&&(r=1);++n<r;)for(var u=t[n],d=i(u),m=-1,p=d.length;++m<p;){var f=d[m],h=e[f];(void 0===h||a(h,c[f])&&!l.call(e,f))&&(e[f]=u[f])}return e}));e.exports=s},2404:(e,t,n)=>{var r=n(60270);e.exports=function(e,t){return r(e,t)}},75866:e=>{var t=Array.prototype.join;e.exports=function(e,n){return null==e?"":t.call(e,n)}},99786:(e,t,n)=>{var r=n(83120),a=n(15389),o=n(69302),i=n(55765),c=n(83693),l=n(68090),s=o((function(e){var t=l(e);return c(t)&&(t=void 0),i(r(e,1,c,!0),a(t,2))}));e.exports=s},52230:(e,t,n)=>{"use strict";n.d(t,{x:()=>o});var r=n(96540),a=n(65414);function o(e){var t=e.i18n,n=e.defaultNS,o=e.children,i=(0,r.useMemo)((function(){return{i18n:t,defaultNS:n}}),[t,n]);return(0,r.createElement)(a.gJ.Provider,{value:i},o)}},21966:(e,t,n)=>{"use strict";var r=n(68238).compose;t.tY="undefined"!==typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!==arguments.length)return"object"===typeof arguments[0]?r:r.apply(null,arguments)},"undefined"!==typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__},45458:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(43145);var a=n(27800);function o(e){return function(e){if(Array.isArray(e))return(0,r.A)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||(0,a.A)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}}},e=>{e.O(0,[402,1057,7655,5373,6267,9777,5941,7501,4218,2373,9809,8102,742,6528,3532,9945,1357,8962,9693],(()=>{return t=33020,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=invenio-app-rdm-landing-page.885c9b0d2ab8e3087517.js.map